/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[TYPE_NB];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 62, 78), S( 59, 67), S( 36, 59), S( 58,  2), S( 50,  5), S( 51, 12), S(-61, 73), S(-62, 79),
      S(  5, 96), S( 20, 86), S( 38, 44), S( 41, -5), S( 60, -9), S(129, 14), S( 85, 46), S( 33, 56),
      S( -5, 46), S( -8, 26), S( -7, 10), S(  7,-27), S( 24,-19), S( 39,-15), S( 11, 10), S(  4, 12),
      S(-10, 17), S(-21, 14), S(-10,-10), S(-13,-15), S( -2,-14), S(  5,-12), S( -3, -5), S( -2, -8),
      S(-18,  6), S(-29,  0), S(-26, -3), S(-21,-11), S(-12, -2), S( -5,  2), S(  3,-15), S( -3,-17),
      S( -7, 13), S(-10, 10), S(-17,  8), S( -8,  3), S(-13, 22), S( 20, 10), S( 32, -6), S(  5,-25),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-171,-82), S(-69,-20), S(-102, 20), S(-40,  1), S( -5, 11), S(-86, 22), S(-58,-16), S(-131,-100),
      S( -5,-23), S( -3, -1), S( 44,-10), S( 50, 22), S( 54,  8), S( 67,-30), S(-16,  4), S(  0,-31),
      S(-23,-14), S( 21,  4), S( 30, 46), S( 47, 44), S( 87, 23), S( 68, 28), S( 36, -6), S( -6,-17),
      S(  6,-10), S( 21, 13), S( 42, 48), S( 36, 61), S( 24, 59), S( 61, 38), S( 25, 17), S( 32, -8),
      S( -4,  0), S( 13,  9), S( 19, 50), S( 23, 51), S( 20, 50), S( 31, 45), S( 47,  8), S( 26, 10),
      S(-25,-41), S( -8, -5), S( -5, 13), S( 11, 34), S( 11, 32), S(  4, 10), S(  7, -2), S( -4,-17),
      S(-37,-23), S(-42,  1), S(-22,-13), S( -9, 10), S(-13,  5), S(-13,-17), S(-24,-16), S( -9, -6),
      S(-76,-44), S(-19,-43), S(-41,-16), S(-10,  7), S( -3,  5), S( -8,-27), S(-16,-21), S(-53,-35) },

    { S(-38, 45), S(-44, 34), S(-89, 39), S(-91, 49), S(-89, 41), S(-114, 34), S(-23, 21), S(-38, 21),
      S(-23, 21), S( 20, 25), S(  6, 25), S(-21, 29), S(  4, 19), S( -9, 27), S(-19, 33), S(-51, 27),
      S(  3, 20), S( 28, 21), S( 52, 19), S( 34, 14), S( 42, 17), S( 52, 25), S( 22, 26), S(  8, 14),
      S( -5, 11), S( 36, 14), S( 26, 16), S( 51, 31), S( 39, 29), S( 32, 20), S( 41, 13), S( -4, 16),
      S( 11, -8), S( 17,  1), S( 19, 25), S( 34, 25), S( 30, 25), S( 22, 16), S( 22,  6), S( 35, -9),
      S(  8, -8), S( 27,  9), S( 18, 12), S( 13, 19), S( 18, 22), S( 24, 10), S( 31, -1), S( 32,-10),
      S( 20, -8), S( 18,-29), S( 21, -9), S( -1,  6), S(  0,  5), S(  7,-13), S( 25,-31), S( 24,-49),
      S( 28,-12), S( 33,  3), S( 11,  7), S( -6,  5), S(  6,  7), S(  9, -4), S( 18,-12), S( 28,-21) },

    { S( 35, 52), S( 35, 60), S( -1, 79), S(  6, 70), S( 16, 69), S( 17, 68), S( 36, 62), S( 45, 58),
      S(  0, 58), S(-17, 70), S(  9, 67), S( 14, 70), S(  5, 68), S( 13, 40), S(  0, 49), S( 22, 40),
      S( -1, 52), S( 47, 33), S( 24, 50), S( 50, 31), S( 65, 20), S( 59, 30), S( 79,  8), S( 26, 32),
      S( -5, 45), S( 14, 43), S( 24, 45), S( 45, 32), S( 39, 29), S( 43, 21), S( 40, 18), S( 23, 26),
      S(-22, 33), S(-19, 47), S(-18, 45), S(-11, 36), S(-15, 32), S(-21, 32), S(  3, 23), S(-12, 18),
      S(-29, 12), S(-21, 25), S(-29, 20), S(-22, 12), S(-21, 12), S(-22,  2), S(  5, -6), S(-17, -5),
      S(-47, 16), S(-25, 11), S(-16, 15), S(-12,  8), S( -9, -1), S(-19, -8), S( -8,-16), S(-41,  1),
      S(-23, 20), S(-21, 18), S(-20, 21), S(-10,  7), S(-12,  3), S(-10, 10), S( -3,  1), S(-18, -1) },

    { S(-22, 32), S( -1, 48), S(  9, 69), S( 19, 79), S( 24, 91), S( 49, 86), S( 35, 79), S( 31, 67),
      S(-20, 21), S(-60, 65), S(-30, 68), S(-69,133), S(-63,164), S( -7,114), S(-36,106), S( 12,101),
      S(-16, 10), S( -3,  4), S(-12, 45), S(-16, 78), S(  8,109), S( 37,116), S( 55, 82), S( 13, 91),
      S(  1,-18), S(  0, 24), S(-13, 33), S(-16, 85), S(-11,114), S(  1,121), S( 39,109), S( 16, 78),
      S(  8,-33), S(  6, 11), S( -2, 16), S( -7, 57), S( -9, 63), S(  9, 46), S( 23, 31), S( 35, 32),
      S(  2,-53), S( 15,-28), S(  6, -5), S(  1, -8), S(  5, -6), S(  5, -7), S( 31,-37), S( 23,-43),
      S(  6,-62), S( 11,-56), S( 16,-66), S( 12,-30), S( 13,-40), S( 13,-116), S( 21,-136), S( 10,-78),
      S( -1,-70), S( -9,-72), S( -4,-68), S(  4,-69), S(  3,-72), S(-16,-81), S( -9,-95), S(  5,-78) },

    { S(-89,-123), S(-50,-59), S(-66,-29), S(-63,  4), S(-73,-17), S(-57,-14), S(-49, -3), S(-66,-122),
      S(-67,-44), S(-15, 36), S(-27, 44), S(-21, 38), S(-11, 29), S(-11, 39), S( -6, 48), S(-44,-39),
      S(-28,-14), S( 33, 46), S( 33, 68), S( 26, 71), S( 42, 68), S( 61, 66), S( 40, 48), S(-34,-17),
      S(-32,-15), S( 28, 27), S( 34, 73), S( 22, 94), S( 20, 86), S( 48, 61), S( 22, 22), S(-72,-20),
      S(-32,-54), S( 38,  8), S( 50, 52), S( -1, 86), S( 19, 76), S( 38, 44), S( 43,  1), S(-96,-35),
      S(-44,-42), S( 29, -9), S(  7, 27), S( -4, 49), S( 18, 41), S(  4, 28), S( 19,-12), S(-61,-35),
      S(  5,-45), S(  6,-20), S(-14,  6), S(-63, 24), S(-45, 19), S(-31, 10), S(  5,-26), S( -1,-67),
      S(-26,-124), S( 24,-78), S(-10,-44), S(-96,-40), S(-36,-70), S(-87,-27), S(  5,-79), S(-14,-146) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

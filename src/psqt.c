/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[TYPE_NB];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 61, 76), S( 56, 67), S( 38, 57), S( 57,  2), S( 50,  4), S( 49, 12), S(-58, 71), S(-60, 77),
      S(  5, 94), S( 20, 84), S( 39, 43), S( 41, -6), S( 60,-10), S(128, 13), S( 85, 45), S( 33, 55),
      S( -5, 45), S( -8, 26), S( -7, 10), S(  7,-27), S( 24,-18), S( 38,-14), S( 11, 10), S(  4, 12),
      S(-10, 17), S(-21, 14), S(-10,-10), S(-13,-15), S( -2,-14), S(  5,-12), S( -3, -5), S( -2, -8),
      S(-18,  6), S(-29,  1), S(-26, -3), S(-21,-11), S(-12, -2), S( -5,  2), S(  2,-14), S( -3,-16),
      S( -7, 13), S(-10, 10), S(-16,  8), S( -8,  3), S(-13, 22), S( 20, 10), S( 31, -6), S(  5,-24),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-164,-85), S(-64,-22), S(-96, 17), S(-38, -1), S( -6,  9), S(-81, 17), S(-56,-17), S(-127,-98),
      S( -6,-22), S( -4, -1), S( 43,-10), S( 50, 20), S( 52,  8), S( 65,-30), S(-17,  4), S( -4,-30),
      S(-23,-14), S( 20,  4), S( 29, 45), S( 46, 43), S( 86, 21), S( 66, 27), S( 35, -7), S( -7,-16),
      S(  6,-10), S( 20, 12), S( 41, 47), S( 35, 60), S( 23, 57), S( 60, 37), S( 24, 16), S( 31, -8),
      S( -5,  0), S( 13,  9), S( 18, 48), S( 22, 50), S( 19, 49), S( 30, 44), S( 46,  7), S( 25,  9),
      S(-26,-40), S( -9, -5), S( -5, 12), S( 10, 33), S( 11, 31), S(  4, 10), S(  7, -2), S( -5,-17),
      S(-37,-22), S(-42,  1), S(-22,-13), S( -9, 10), S(-13,  4), S(-14,-17), S(-24,-16), S(-10, -6),
      S(-72,-44), S(-19,-42), S(-40,-17), S(-10,  7), S( -3,  5), S( -8,-27), S(-16,-20), S(-51,-36) },

    { S(-38, 43), S(-42, 32), S(-83, 36), S(-86, 45), S(-83, 38), S(-108, 30), S(-23, 19), S(-38, 19),
      S(-23, 20), S( 19, 24), S(  6, 24), S(-20, 28), S(  3, 18), S(-10, 26), S(-19, 31), S(-51, 27),
      S(  3, 20), S( 27, 20), S( 52, 18), S( 34, 13), S( 42, 15), S( 51, 24), S( 22, 25), S(  8, 13),
      S( -6, 11), S( 35, 14), S( 25, 15), S( 50, 30), S( 38, 28), S( 31, 19), S( 40, 12), S( -4, 16),
      S( 11, -8), S( 16,  1), S( 18, 24), S( 34, 24), S( 29, 24), S( 22, 15), S( 21,  6), S( 35, -9),
      S(  8, -9), S( 26,  8), S( 17, 12), S( 12, 18), S( 17, 21), S( 23,  9), S( 30, -1), S( 32,-10),
      S( 20, -8), S( 17,-29), S( 21,-10), S( -1,  6), S(  0,  5), S(  7,-13), S( 25,-31), S( 24,-48),
      S( 28,-12), S( 32,  3), S( 11,  7), S( -6,  5), S(  6,  6), S(  8, -4), S( 17,-11), S( 27,-21) },

    { S( 35, 48), S( 34, 56), S(  1, 74), S(  7, 65), S( 18, 64), S( 17, 63), S( 36, 57), S( 44, 54),
      S(  0, 54), S(-16, 66), S(  9, 63), S( 14, 66), S(  6, 64), S( 13, 37), S( -1, 46), S( 20, 37),
      S( -1, 48), S( 46, 29), S( 24, 46), S( 50, 27), S( 64, 16), S( 58, 26), S( 78,  5), S( 27, 28),
      S( -5, 42), S( 14, 39), S( 24, 42), S( 45, 29), S( 39, 25), S( 42, 18), S( 39, 15), S( 23, 23),
      S(-22, 30), S(-19, 44), S(-18, 42), S(-11, 32), S(-15, 29), S(-21, 29), S(  3, 20), S(-12, 16),
      S(-29, 10), S(-20, 22), S(-28, 17), S(-21, 10), S(-21,  9), S(-22, -1), S(  5, -8), S(-17, -8),
      S(-46, 14), S(-25,  9), S(-16, 12), S(-12,  5), S( -9, -3), S(-19,-10), S( -8,-18), S(-41, -1),
      S(-24, 18), S(-21, 16), S(-20, 18), S(-10,  4), S(-12,  1), S(-10,  8), S( -4, -1), S(-18, -2) },

    { S(-20, 25), S(  0, 42), S( 11, 62), S( 20, 72), S( 25, 83), S( 47, 79), S( 31, 71), S( 28, 59),
      S(-20, 17), S(-60, 61), S(-31, 64), S(-66,124), S(-61,154), S( -6,105), S(-36, 99), S(  9, 96),
      S(-16,  6), S( -4,  1), S(-13, 41), S(-17, 74), S(  8,102), S( 34,111), S( 51, 78), S( 12, 84),
      S( -1,-19), S(  0, 20), S(-14, 29), S(-16, 80), S(-11,108), S(  2,113), S( 38,102), S( 16, 71),
      S(  8,-36), S(  5,  8), S( -3, 13), S( -8, 53), S( -9, 58), S(  8, 42), S( 22, 27), S( 33, 28),
      S(  1,-55), S( 15,-31), S(  5, -8), S(  0,-11), S(  4, -9), S(  4,-10), S( 30,-40), S( 21,-45),
      S(  5,-64), S( 10,-58), S( 15,-69), S( 11,-33), S( 12,-43), S( 12,-117), S( 19,-131), S(  7,-75),
      S( -1,-72), S( -9,-74), S( -5,-70), S(  3,-71), S(  3,-74), S(-15,-86), S( -9,-94), S(  4,-79) },

    { S(-87,-118), S(-50,-57), S(-67,-27), S(-63,  4), S(-73,-15), S(-58,-14), S(-51, -5), S(-66,-118),
      S(-66,-44), S(-15, 35), S(-29, 44), S(-24, 38), S(-13, 29), S(-14, 39), S( -9, 48), S(-45,-39),
      S(-27,-14), S( 29, 46), S( 30, 67), S( 26, 70), S( 40, 67), S( 57, 66), S( 36, 48), S(-34,-16),
      S(-31,-15), S( 27, 27), S( 32, 72), S( 24, 92), S( 20, 84), S( 47, 60), S( 20, 22), S(-69,-20),
      S(-30,-54), S( 38,  7), S( 50, 50), S(  4, 83), S( 21, 74), S( 38, 43), S( 43,  0), S(-91,-36),
      S(-44,-41), S( 29, -9), S(  9, 26), S( -3, 48), S( 19, 40), S(  4, 27), S( 19,-12), S(-60,-35),
      S(  5,-44), S(  6,-20), S(-13,  5), S(-62, 23), S(-44, 19), S(-30,  9), S(  6,-25), S(  0,-66),
      S(-26,-121), S( 24,-77), S(-10,-43), S(-94,-40), S(-35,-69), S(-86,-26), S(  6,-78), S(-14,-144) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[TYPE_NB];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 29, 42), S( 38, 45), S( 31, 62), S( 79, 21), S( 75, 27), S( 74, 25), S(-39, 80), S(-49, 61),
      S(  0, 76), S( 10, 77), S( 33, 47), S( 49, 15), S( 78, 13), S(135, 21), S( 95, 48), S( 37, 55),
      S( -9, 42), S(-12, 24), S(-10,  8), S(  5,-24), S( 23,-17), S( 38,-16), S(  9,  9), S(  2, 14),
      S(-14, 17), S(-25, 13), S(-13,-11), S(-15,-17), S( -4,-16), S(  3,-13), S( -5, -7), S( -4, -6),
      S(-22,  4), S(-34, -2), S(-29, -3), S(-24,-10), S(-15, -1), S( -7,  2), S(  1,-16), S( -5,-16),
      S(-11, 11), S(-13,  9), S(-20, 11), S(-11,  8), S(-16, 27), S( 19, 14), S( 31, -5), S(  3,-24),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-186,-77), S(-81,-17), S(-115, 25), S(-44,  4), S( -4, 14), S(-98, 30), S(-63,-13), S(-141,-105),
      S( -4,-22), S( -2,  0), S( 47,-11), S( 52, 25), S( 59, 10), S( 71,-29), S(-15,  4), S(  7,-33),
      S(-23,-11), S( 23,  7), S( 32, 49), S( 50, 49), S( 92, 27), S( 74, 32), S( 40, -5), S( -3,-16),
      S(  8, -8), S( 23, 15), S( 45, 51), S( 39, 66), S( 26, 64), S( 64, 42), S( 27, 20), S( 35, -6),
      S( -3,  2), S( 15, 11), S( 20, 52), S( 24, 55), S( 22, 55), S( 33, 49), S( 50, 10), S( 28, 12),
      S(-24,-43), S( -7, -6), S( -3, 13), S( 12, 36), S( 13, 34), S(  6, 12), S(  9, -1), S( -3,-17),
      S(-36,-33), S(-41, -4), S(-21,-16), S( -7,  9), S(-12,  5), S(-12,-16), S(-23,-15), S( -8, -7),
      S(-85,-50), S(-17,-48), S(-41,-18), S( -9,  6), S( -2,  6), S( -7,-26), S(-15,-21), S(-55,-35) },

    { S(-40, 49), S(-48, 39), S(-103, 47), S(-103, 54), S(-102, 48), S(-129, 41), S(-24, 23), S(-39, 24),
      S(-23, 23), S( 20, 28), S(  6, 27), S(-22, 34), S(  4, 22), S( -9, 32), S(-19, 36), S(-51, 30),
      S(  3, 24), S( 29, 23), S( 54, 22), S( 37, 17), S( 45, 20), S( 54, 30), S( 24, 31), S(  9, 17),
      S( -5, 13), S( 38, 16), S( 28, 17), S( 54, 35), S( 41, 32), S( 35, 23), S( 42, 15), S( -3, 18),
      S( 12, -6), S( 18,  2), S( 20, 27), S( 36, 28), S( 31, 29), S( 23, 18), S( 23,  8), S( 37, -8),
      S( 10, -9), S( 29,  9), S( 19, 12), S( 14, 19), S( 19, 22), S( 25, 11), S( 33,  0), S( 34, -8),
      S( 23,-14), S( 20,-31), S( 24,-13), S(  1,  4), S(  1,  5), S(  8,-13), S( 27,-29), S( 26,-52),
      S( 31,-17), S( 37, -3), S( 13,  7), S( -4,  3), S(  8,  4), S( 10, -3), S( 20,-11), S( 30,-24) },

    { S( 35, 62), S( 35, 71), S( -3, 91), S(  4, 81), S( 15, 81), S( 17, 79), S( 37, 74), S( 48, 69),
      S( -1, 69), S(-17, 79), S( 10, 76), S( 16, 79), S(  6, 77), S( 15, 49), S(  2, 58), S( 24, 48),
      S( -2, 64), S( 48, 42), S( 25, 59), S( 51, 41), S( 67, 29), S( 62, 40), S( 84, 16), S( 28, 43),
      S( -6, 56), S( 14, 52), S( 24, 54), S( 47, 41), S( 40, 38), S( 45, 30), S( 43, 26), S( 24, 37),
      S(-23, 42), S(-20, 56), S(-19, 54), S(-11, 43), S(-15, 39), S(-20, 40), S(  4, 31), S(-12, 27),
      S(-29, 17), S(-21, 31), S(-29, 25), S(-22, 18), S(-21, 17), S(-22,  8), S(  7,  2), S(-17,  2),
      S(-46, 16), S(-25, 15), S(-16, 18), S(-12, 11), S( -9,  4), S(-18, -3), S( -7,-10), S(-41,  6),
      S(-23, 22), S(-21, 20), S(-20, 24), S( -9, 10), S(-11,  6), S( -9, 14), S( -3,  8), S(-18,  4) },

    { S(-25, 49), S( -3, 63), S(  6, 86), S( 18, 95), S( 21,110), S( 52,103), S( 41, 95), S( 35, 84),
      S(-19, 32), S(-59, 73), S(-29, 77), S(-74,153), S(-68,188), S( -9,134), S(-37,123), S( 16,114),
      S(-14, 19), S( -1, 10), S(-11, 53), S(-14, 91), S(  9,126), S( 42,130), S( 61, 93), S( 14,108),
      S(  3,-11), S(  2, 33), S(-12, 41), S(-15, 97), S(-10,130), S(  1,140), S( 40,126), S( 18, 95),
      S( 11,-27), S(  8, 19), S(  0, 25), S( -6, 68), S( -8, 75), S( 10, 58), S( 25, 42), S( 37, 44),
      S(  4,-48), S( 18,-22), S(  8,  2), S(  3, -3), S(  7,  0), S(  7,  2), S( 33,-30), S( 26,-37),
      S(  8,-58), S( 13,-51), S( 18,-62), S( 14,-26), S( 15,-36), S( 15,-115), S( 26,-140), S( 16,-83),
      S(  1,-65), S( -7,-67), S( -3,-64), S(  6,-66), S(  5,-68), S(-16,-74), S( -6,-94), S(  8,-73) },

    { S(-92,-131), S(-49,-59), S(-65,-31), S(-63,  5), S(-73,-16), S(-54,-10), S(-43,  5), S(-65,-126),
      S(-70,-40), S(-16, 37), S(-24, 42), S(-14, 34), S( -6, 29), S( -3, 44), S(  3, 59), S(-38,-28),
      S(-29, -7), S( 40, 42), S( 36, 62), S( 23, 66), S( 45, 64), S( 70, 70), S( 52, 56), S(-29, -4),
      S(-33, -5), S( 27, 25), S( 30, 65), S( 11, 86), S( 15, 82), S( 48, 60), S( 29, 31), S(-71, -3),
      S(-35,-48), S( 36, -1), S( 45, 42), S(-17, 77), S( 12, 70), S( 41, 42), S( 46,  3), S(-98,-19),
      S(-41,-46), S( 35,-17), S(  9, 15), S( -8, 37), S( 15, 31), S(  4, 23), S( 20,-11), S(-59,-30),
      S(  9,-49), S(  9,-25), S(-11, -4), S(-65, 12), S(-48, 10), S(-35,  7), S(  4,-23), S( -3,-58),
      S(-27,-120), S( 22,-72), S(-12,-40), S(-101,-42), S(-39,-72), S(-94,-23), S(  3,-72), S(-18,-136) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

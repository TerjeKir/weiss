/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 60, 48), S( 46, 52), S( 53, 28), S( 53, -3), S( 53, -4), S( 40, 15), S(-30, 53), S(-34, 53),
      S(  8, 65), S( 36, 53), S( 49, 25), S( 49,-10), S( 68,-14), S(111,  7), S( 68, 31), S( 22, 43),
      S( -1, 27), S( -3, 17), S( -1,  4), S( 18,-23), S( 26,-18), S( 31,-10), S(  0,  9), S( -1, 10),
      S(-11,  7), S(-15,  5), S( -7,-12), S( -5,-16), S(  4,-17), S(  0,-12), S( -6, -5), S( -9, -6),
      S(-18, -1), S(-25, -5), S(-22, -5), S(-18, -9), S(-13, -4), S(-13,  0), S( -4,-13), S( -8,-14),
      S( -6,  2), S(-10,  1), S(-14,  7), S( -5,  5), S(-11, 12), S( 12,  7), S( 16, -8), S(  4,-22),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-108,-90), S(-34,-24), S(-53,  7), S(-18, -4), S( -4, -1), S(-43, 10), S(-35,-18), S(-89,-71),
      S( -9,-24), S(-14, -3), S( 43,-15), S( 60, 11), S( 51,  8), S( 53,-22), S(-27, -5), S(-17,-20),
      S(-24,-18), S( 19, -2), S( 28, 35), S( 47, 31), S( 80, 16), S( 57, 27), S( 33,-10), S(-17,-16),
      S(  5,-10), S( 15, 10), S( 31, 39), S( 26, 49), S( 18, 48), S( 38, 31), S( 13, 12), S( 11, -8),
      S(  0, -7), S( 18,  6), S( 13, 38), S( 18, 40), S( 21, 36), S( 19, 36), S( 36,  4), S( 22,  2),
      S(-24,-41), S( -6,-12), S( -8,  8), S(  4, 24), S(  5, 22), S( -1,  6), S(  1, -8), S( -7,-31),
      S(-27,-17), S(-44,  0), S(-21,-18), S( -7,  3), S(-12,  0), S(-18,-19), S(-33, -7), S(-11, -6),
      S(-54,-49), S(-15,-45), S(-17,-26), S(-12,  2), S( -4,  3), S(-12,-22), S(-14,-26), S(-54,-48) },

    { S(-35, 25), S(-23, 17), S(-46, 15), S(-47, 23), S(-42, 21), S(-64, 12), S(-14, 11), S(-22, 13),
      S(-42, 23), S( 10, 19), S(  5, 18), S(-19, 20), S( -4, 16), S( -5, 20), S(-14, 23), S(-56, 26),
      S(  5,  9), S( 26, 15), S( 56, 10), S( 35,  9), S( 49,  8), S( 47, 17), S( 22, 17), S(  6,  5),
      S( -6,  5), S( 33,  9), S( 23,  9), S( 50, 16), S( 39, 19), S( 21, 12), S( 30,  9), S(-10,  8),
      S(  5,-11), S( 16, -4), S( 17, 15), S( 31, 15), S( 31, 14), S( 16, 11), S( 17, -1), S( 19,-13),
      S(  9,-15), S( 21,  1), S( 15,  7), S( 14, 10), S( 14, 11), S( 20,  4), S( 28, -6), S( 26,-11),
      S( 20,-21), S( 17,-30), S(  9,-11), S(  0,  0), S(  0, -1), S(  6,-17), S( 21,-31), S( 22,-45),
      S( 25,-17), S( 14,  5), S( 11, -1), S(  3, -2), S(  3,  3), S(  8, -7), S( 10,  5), S( 23,-22) },

    { S( 39, 28), S( 31, 37), S(  7, 47), S( 11, 43), S( 16, 42), S( 14, 44), S( 31, 36), S( 36, 35),
      S(  1, 32), S( -9, 39), S( 17, 36), S( 25, 41), S( 16, 41), S( 31, 17), S( -3, 27), S(  7, 23),
      S(  5, 25), S( 52,  7), S( 35, 21), S( 63,  6), S( 78, -4), S( 63,  9), S( 79,-10), S( 25, 13),
      S( -2, 18), S( 15, 17), S( 24, 19), S( 49,  8), S( 39,  8), S( 33,  5), S( 32,  2), S( 18,  8),
      S(-22,  8), S(-17, 21), S(-18, 21), S(-12, 14), S(-13,  9), S(-19, 13), S( -1,  7), S(-15,  2),
      S(-30,-11), S(-17,  0), S(-27, -2), S(-18, -8), S(-21, -9), S(-23,-11), S( -4,-12), S(-24,-17),
      S(-59, -1), S(-22,-13), S(-16, -8), S(-10,-13), S( -9,-17), S(-16,-24), S(-14,-25), S(-63, -6),
      S(-21, -8), S(-16, -6), S(-15, -3), S( -7,-14), S(-10,-16), S( -8, -9), S( -6,-14), S(-14,-20) },

    { S( -2, 12), S( 10, 28), S( 20, 37), S( 26, 53), S( 32, 63), S( 48, 61), S( 28, 48), S( 30, 42),
      S(-20, 12), S(-72, 58), S(-24, 42), S(-44, 72), S(-42,103), S(  4, 74), S(-53, 51), S(-28, 52),
      S(-13,  1), S( -4, -4), S(-12, 28), S(-10, 49), S( 14, 67), S( 27, 84), S( 39, 61), S(  7, 68),
      S( -2,-19), S( -2, 21), S(-14, 19), S(-18, 65), S(-15, 80), S(-12, 88), S( 21, 81), S(  8, 57),
      S(  5,-34), S(  7, -3), S( -1,  1), S(-11, 44), S( -8, 39), S( -1, 32), S( 12, 16), S( 16, 21),
      S(  1,-54), S( 14,-41), S(  5,-17), S(  1,-26), S(  4,-26), S(  1,-15), S( 20,-44), S(  8,-38),
      S(  3,-60), S( 11,-64), S( 17,-85), S( 11,-41), S( 13,-51), S( 14,-113), S( 11,-101), S( -8,-53),
      S(  0,-71), S( -2,-85), S(  2,-88), S(  6,-77), S(  6,-81), S( -1,-93), S( -1,-71), S( -5,-67) },

    { S(-78,-83), S(-50,-44), S(-70,-12), S(-64,  5), S(-76,-12), S(-68,-27), S(-65,-22), S(-67,-94),
      S(-62,-47), S(-18, 31), S(-38, 34), S(-47, 21), S(-30, 13), S(-38, 25), S(-28, 36), S(-56,-51),
      S(-21,-13), S(  7, 41), S( 15, 53), S( 19, 47), S( 15, 42), S( 28, 48), S(  9, 38), S(-42,-21),
      S(-19,-11), S( 19, 23), S( 23, 58), S( 39, 69), S( 24, 66), S( 48, 46), S( 10, 18), S(-46,-24),
      S(-10,-43), S( 37, 12), S( 56, 42), S( 39, 65), S( 50, 60), S( 55, 36), S( 66,  2), S(-50,-40),
      S(-32,-27), S( 22,  1), S( 35, 23), S( 22, 42), S( 39, 36), S( 20, 26), S( 25, -2), S(-46,-25),
      S( -1,-30), S( -3, -5), S(-16, 14), S(-63, 28), S(-42, 22), S(-36, 17), S( -3,-10), S( -3,-46),
      S(-33,-97), S(  5,-57), S(-26,-26), S(-53,-44), S(-39,-58), S(-77,-19), S(  0,-55), S(-22,-116) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

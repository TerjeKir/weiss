/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[TYPE_NB];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 23, 29), S( 36, 42), S( 29, 64), S( 80, 28), S( 82, 34), S( 80, 28), S(-32, 82), S(-47, 56),
      S(  4, 67), S( 18, 71), S( 36, 48), S( 43, 24), S( 68, 26), S(134, 29), S( 95, 55), S( 35, 62),
      S( -9, 40), S(-10, 19), S( -9,  6), S(  5,-25), S( 24,-16), S( 39,-17), S( 10,  8), S(  2, 16),
      S(-17, 19), S(-26, 12), S(-12,-12), S(-14,-16), S( -3,-16), S(  4,-14), S( -4, -8), S( -4, -6),
      S(-24,  4), S(-34, -2), S(-29, -3), S(-24,-10), S(-15,  0), S( -7,  3), S(  2,-16), S( -5,-15),
      S(-12, 10), S(-14,  8), S(-20, 11), S(-11,  9), S(-16, 29), S( 20, 16), S( 32, -4), S(  3,-24),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-191,-75), S(-85,-17), S(-120, 26), S(-46,  4), S( -4, 14), S(-102, 32), S(-65,-13), S(-144,-107),
      S( -3,-23), S( -2, -1), S( 48,-12), S( 53, 26), S( 60, 10), S( 73,-30), S(-15,  3), S(  9,-35),
      S(-23,-12), S( 24,  6), S( 34, 50), S( 52, 50), S( 94, 28), S( 76, 33), S( 42, -6), S( -1,-17),
      S(  7, -4), S( 23, 17), S( 46, 54), S( 40, 69), S( 27, 68), S( 66, 45), S( 28, 23), S( 36, -4),
      S( -2,  2), S( 15, 11), S( 21, 53), S( 25, 55), S( 23, 56), S( 34, 51), S( 51, 11), S( 29, 12),
      S(-24,-43), S( -7, -6), S( -3, 14), S( 13, 36), S( 14, 34), S(  6, 12), S(  9, -1), S( -3,-17),
      S(-36,-34), S(-41, -4), S(-21,-16), S( -7,  9), S(-12,  5), S(-12,-16), S(-24,-15), S( -8, -7),
      S(-87,-52), S(-17,-49), S(-42,-19), S( -9,  6), S( -2,  5), S( -7,-26), S(-15,-21), S(-55,-35) },

    { S(-40, 50), S(-49, 40), S(-108, 49), S(-107, 56), S(-106, 50), S(-133, 42), S(-24, 23), S(-39, 24),
      S(-23, 22), S( 21, 28), S(  6, 27), S(-22, 34), S(  5, 22), S( -9, 32), S(-19, 36), S(-51, 30),
      S(  3, 24), S( 30, 23), S( 55, 23), S( 38, 17), S( 46, 21), S( 55, 31), S( 25, 32), S( 10, 17),
      S( -5, 16), S( 38, 18), S( 28, 19), S( 55, 37), S( 42, 34), S( 36, 25), S( 43, 18), S( -3, 21),
      S( 13, -7), S( 19,  2), S( 21, 28), S( 37, 28), S( 32, 29), S( 24, 19), S( 24,  9), S( 38, -8),
      S( 10, -9), S( 30, 10), S( 20, 13), S( 15, 20), S( 19, 23), S( 26, 12), S( 33,  0), S( 35, -8),
      S( 23,-13), S( 20,-31), S( 24,-12), S(  1,  5), S(  1,  5), S(  8,-14), S( 27,-29), S( 27,-52),
      S( 32,-17), S( 38, -2), S( 13,  7), S( -5,  4), S(  7,  5), S( 10, -2), S( 20,-10), S( 31,-24) },

    { S( 35, 64), S( 35, 74), S( -3, 93), S(  4, 84), S( 15, 83), S( 17, 82), S( 37, 77), S( 49, 71),
      S(  0, 70), S(-16, 80), S( 11, 78), S( 17, 81), S(  7, 79), S( 16, 50), S(  2, 60), S( 25, 49),
      S( -2, 65), S( 49, 42), S( 26, 61), S( 52, 42), S( 68, 31), S( 63, 42), S( 85, 18), S( 28, 44),
      S( -7, 61), S( 14, 54), S( 25, 56), S( 47, 44), S( 40, 40), S( 46, 33), S( 43, 29), S( 24, 40),
      S(-23, 40), S(-21, 57), S(-20, 55), S(-12, 44), S(-16, 40), S(-20, 41), S(  4, 33), S(-12, 28),
      S(-30, 18), S(-21, 31), S(-30, 26), S(-23, 18), S(-21, 17), S(-22,  8), S(  7,  3), S(-17,  3),
      S(-47, 19), S(-25, 16), S(-16, 19), S(-12, 12), S( -9,  4), S(-18, -2), S( -7, -8), S(-42,  9),
      S(-22, 24), S(-21, 22), S(-20, 26), S( -9, 10), S(-11,  7), S( -8, 16), S( -3, 12), S(-18,  9) },

    { S(-25, 55), S( -3, 69), S(  5, 93), S( 18,101), S( 20,118), S( 52,109), S( 43,101), S( 35, 90),
      S(-18, 36), S(-59, 77), S(-28, 81), S(-75,161), S(-70,197), S( -9,142), S(-38,129), S( 17,120),
      S(-14, 22), S(  0, 13), S( -9, 57), S(-13, 96), S( 10,132), S( 43,136), S( 63, 98), S( 16,115),
      S(  4, -6), S(  3, 37), S(-10, 46), S(-13,103), S( -9,138), S(  3,148), S( 42,134), S( 20,102),
      S( 12,-23), S(  9, 23), S(  0, 28), S( -6, 72), S( -7, 80), S( 12, 63), S( 27, 47), S( 39, 50),
      S(  6,-46), S( 19,-18), S(  9,  6), S(  4,  0), S(  8,  3), S(  8,  5), S( 35,-27), S( 27,-33),
      S(  9,-56), S( 14,-48), S( 19,-60), S( 15,-23), S( 16,-33), S( 16,-114), S( 27,-140), S( 17,-83),
      S(  1,-63), S( -7,-65), S( -2,-62), S(  7,-64), S(  6,-67), S(-16,-72), S( -5,-94), S(  8,-71) },

    { S(-93,-133), S(-49,-59), S(-65,-31), S(-63,  5), S(-73,-16), S(-54, -8), S(-41,  7), S(-65,-127),
      S(-72,-42), S(-17, 35), S(-24, 40), S(-12, 32), S( -4, 29), S( -1, 44), S(  5, 59), S(-38,-28),
      S(-31,-10), S( 42, 40), S( 37, 60), S( 22, 64), S( 46, 62), S( 72, 69), S( 55, 54), S(-31, -8),
      S(-34, -7), S( 28, 25), S( 29, 64), S(  6, 83), S( 12, 80), S( 47, 58), S( 31, 31), S(-72, -3),
      S(-36,-47), S( 38,  2), S( 46, 41), S(-21, 75), S( 10, 67), S( 42, 42), S( 47,  6), S(-100,-18),
      S(-39,-45), S( 38,-18), S( 12, 13), S( -7, 35), S( 16, 29), S(  5, 23), S( 21,-10), S(-59,-27),
      S( 11,-48), S( 11,-25), S( -9, -5), S(-65, 11), S(-47,  9), S(-35,  8), S(  3,-19), S( -5,-53),
      S(-28,-120), S( 22,-69), S(-12,-40), S(-101,-45), S(-39,-73), S(-96,-20), S(  2,-68), S(-20,-129) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

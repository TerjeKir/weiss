/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[7][64] = {
    { 0 },

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 47, 68), S( 34, 58), S( 36, 36), S( 31, 11), S( 36,  0), S( 13,  7), S(  5, 22), S(  5, 37),
      S(  3, 73), S( 23, 61), S( 35, 32), S( 29, -4), S( 42, -7), S( 88, 13), S( 43, 33), S( 16, 41),
      S( -2, 34), S( -2, 22), S(  2,  7), S( 23,-23), S( 31,-18), S( 34,-10), S(  4,  7), S(  0,  9),
      S(-13, 12), S(-13,  8), S( -2,-11), S(  1,-17), S(  9,-17), S(  7,-12), S( -3, -5), S(-12, -6),
      S(-17,  2), S(-21, -4), S(-17, -4), S(-11, -9), S( -4, -3), S( -3, -1), S(  1,-15), S( -7,-13),
      S( -6,  7), S(-11,  1), S(-13,  6), S( -4,  3), S( -9, 11), S( 14,  7), S( 17,-12), S(  2,-22),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-57,-66), S(-10,-10), S(-16, -6), S( -2, -7), S(  2, -1), S(-11, -5), S(-16,-16), S(-57,-46),
      S(-20,-19), S(-13, -3), S( 21, -8), S( 33, 21), S( 23, 22), S( 20, -2), S( -1, -9), S(-21,-15),
      S(-19,-15), S( 10,  1), S( 31, 27), S( 46, 22), S( 64, 23), S( 54, 36), S( 37,  8), S(  6, -5),
      S(  1, -5), S(  8, 10), S( 26, 31), S( 31, 43), S( 12, 48), S( 36, 32), S(  8, 23), S( 16,  8),
      S( -5, -3), S(  8,  5), S(  7, 33), S( 13, 38), S( 16, 35), S( 12, 35), S( 36,  9), S( 15, 11),
      S(-34,-31), S(-17,-18), S(-15, -3), S( -2, 16), S(  1, 14), S( -9, -7), S( -8,-14), S(-20,-24),
      S(-34,-20), S(-35,-14), S(-28,-30), S(-11,-11), S(-16,-10), S(-25,-30), S(-32, -7), S(-11,-10),
      S(-53,-58), S(-21,-39), S(-27,-27), S(-20, -9), S(-12, -9), S(-16,-23), S(-22,-23), S(-47,-43) },

    { S( -5,  3), S(  1, -1), S( -7,  8), S( -5,  6), S( -3,  7), S(-14, -1), S( -5,  5), S( -1,  0),
      S(-27, -1), S( -1, 12), S( -5, 10), S(  0,  9), S(  6, 10), S(  3,  9), S( -6,  9), S(-11,  1),
      S( -2,  7), S( 12, 19), S( 29, 17), S( 23, 11), S( 32, 17), S( 36, 30), S( 28, 23), S( 13, 11),
      S(-16,  3), S( 19, 16), S( 12, 11), S( 48, 15), S( 29, 24), S( 23, 14), S( 14, 23), S( -7, 13),
      S(-11, -1), S(  0,  3), S(  5, 19), S( 19, 18), S( 22, 16), S( -1, 16), S(  1,  7), S(  2, -3),
      S( -4, -2), S(  8,  7), S(  3, 12), S(  5, 14), S(  4, 14), S(  8,  7), S( 12, -3), S( 12,  5),
      S( 13, -8), S(  8,-19), S( -1, -9), S(-11,  0), S( -8,  2), S( -6,-16), S( 12,-16), S(  9,-19),
      S( 16, -4), S(  6,  2), S(  0, -5), S(-10, -8), S(-13, -4), S(  1, -1), S( -1,  0), S( 13, -6) },

    { S( 29, 41), S( 23, 47), S( 23, 46), S( 20, 44), S( 34, 41), S( 18, 50), S( 23, 47), S( 20, 52),
      S(  8, 36), S(  1, 41), S( 27, 38), S( 39, 41), S( 34, 44), S( 35, 31), S( 29, 30), S( 32, 28),
      S(  0, 31), S( 36, 21), S( 26, 30), S( 46, 23), S( 56, 19), S( 50, 30), S( 46, 18), S( 33, 22),
      S( -6, 24), S(  9, 22), S( 17, 25), S( 38, 18), S( 31, 19), S( 32, 17), S( 29, 17), S( 21, 20),
      S(-25,  6), S(-15, 16), S(-21, 18), S(-14,  9), S(-17,  8), S(-11, 10), S(  8, 11), S( -3, -2),
      S(-37,-18), S(-22, -5), S(-32,-10), S(-24,-17), S(-25,-16), S(-24,-14), S(  7,-14), S(-21,-20),
      S(-56,-24), S(-28,-24), S(-21,-18), S(-16,-22), S(-14,-24), S(-15,-34), S(-12,-25), S(-41,-21),
      S(-24,-16), S(-19,-14), S(-18,-11), S(-10,-21), S(-13,-24), S(-11,-14), S( -5,-22), S(-14,-31) },

    { S( -2,  5), S(  9, 11), S( 23, 13), S( 19, 30), S( 24, 32), S( 25, 24), S(  9,  7), S( 23, 20),
      S(-13, -5), S(-61, 20), S(-10, 13), S( -2, 20), S(  9, 48), S( 38, 32), S( -6, 10), S( 13, 13),
      S(-15, -3), S( -4,-12), S( -7,  4), S( 10, 12), S( 37, 30), S( 60, 50), S( 69, 46), S( 55, 33),
      S(-11,-14), S( -6,  9), S( -7, -7), S( -6, 25), S( 11, 33), S( 20, 42), S( 40, 39), S( 29, 31),
      S(-12, -7), S( -4, -2), S(-11,  0), S(-19, 27), S(-12, 19), S( -5, 26), S(  7, 18), S( 17, 22),
      S(-19,-18), S( -3,-19), S(-12, -4), S(-15,-20), S(-12,-23), S(-15, -1), S(  5,-21), S( -5,  0),
      S(-21,-18), S(-13,-28), S(  0,-61), S( -4,-35), S( -1,-44), S(-12,-57), S(-16,-44), S(-18,-23),
      S(-25,-24), S(-26,-38), S(-22,-49), S(-12,-57), S(-19,-48), S(-32,-45), S(-24,-26), S(-25,-19) },

    { S(-73,-50), S(-54,-27), S(-72,  6), S(-66, 20), S(-76,  5), S(-70,-25), S(-67,-15), S(-64,-66),
      S(-62,-33), S(-32, 21), S(-55, 34), S(-62, 12), S(-37, 24), S(-53, 28), S(-36, 28), S(-54,-30),
      S(-25, -6), S(-20, 53), S(-18, 61), S( -5, 46), S( -9, 42), S( -2, 65), S(-13, 57), S(-39, -6),
      S(-16,  2), S( -8, 43), S(-19, 66), S(  7, 67), S(-15, 70), S(  7, 60), S(-14, 46), S(-25,-10),
      S(  8,-25), S( -2, 24), S( 10, 51), S(  7, 66), S(  5, 65), S(  6, 49), S( 19, 19), S(-21,-32),
      S(  1,-31), S( 29, -5), S( 12, 22), S(-12, 42), S( 13, 35), S( 14, 19), S( 33,-10), S( -2,-41),
      S( 42,-45), S( 31,-23), S( 13, -5), S(-42,  9), S(-23,  4), S(-20,  1), S( 36,-35), S( 39,-71),
      S(  3,-84), S( 47,-77), S( 15,-49), S(-21,-47), S(  2,-84), S(-44,-41), S( 42,-81), S( 25,-149) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

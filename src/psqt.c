/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[7][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 64, 54), S( 48, 57), S( 55, 33), S( 54,  1), S( 54,  0), S( 39, 18), S(-26, 55), S(-30, 56),
      S(  9, 72), S( 39, 59), S( 51, 30), S( 49, -5), S( 69, -9), S(115, 12), S( 71, 37), S( 23, 48),
      S(  0, 33), S( -2, 24), S(  2, 10), S( 21,-19), S( 28,-13), S( 35, -3), S(  1, 16), S(  0, 15),
      S(-11, 11), S(-12,  9), S( -3, -8), S(  0,-13), S(  8,-13), S(  4, -8), S( -4,  0), S( -9, -3),
      S(-15,  1), S(-23, -3), S(-18, -2), S(-15, -7), S( -9, -1), S( -8,  3), S( -1,-11), S( -4,-11),
      S( -4,  4), S(-11,  1), S(-14,  8), S( -6,  6), S(-11, 14), S( 13,  9), S( 17, -8), S(  5,-21),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-102,-88), S(-31,-23), S(-49,  6), S(-16, -4), S( -3, -1), S(-39,  9), S(-33,-18), S(-85,-68),
      S( -9,-24), S(-13, -3), S( 45,-14), S( 60, 14), S( 52, 10), S( 51,-21), S(-25, -5), S(-16,-20),
      S(-23,-17), S( 20, -1), S( 30, 38), S( 50, 33), S( 83, 18), S( 59, 30), S( 36, -8), S(-15,-14),
      S(  5, -8), S( 17, 11), S( 33, 41), S( 29, 52), S( 19, 52), S( 41, 34), S( 16, 14), S( 13, -5),
      S(  1, -6), S( 19,  7), S( 14, 40), S( 18, 43), S( 22, 38), S( 21, 38), S( 39,  6), S( 24,  5),
      S(-26,-42), S( -8,-13), S(-10,  8), S(  4, 25), S(  5, 23), S( -2,  5), S( -1, -8), S(-10,-31),
      S(-29,-16), S(-47,  0), S(-24,-20), S( -8,  2), S(-13, -2), S(-21,-21), S(-37, -7), S(-11, -5),
      S(-56,-49), S(-16,-47), S(-18,-28), S(-13,  1), S( -5,  2), S(-13,-23), S(-15,-27), S(-56,-48) },

    { S(-32, 24), S(-20, 17), S(-42, 15), S(-42, 23), S(-37, 21), S(-59, 10), S(-13, 11), S(-20, 12),
      S(-43, 23), S( 11, 21), S(  6, 19), S(-18, 21), S( -4, 18), S( -4, 22), S(-14, 24), S(-54, 24),
      S(  4, 10), S( 28, 17), S( 58, 12), S( 37, 11), S( 51, 10), S( 48, 19), S( 24, 19), S(  7,  6),
      S( -7,  6), S( 34, 10), S( 24, 10), S( 54, 19), S( 41, 22), S( 23, 14), S( 30, 11), S( -9,  9),
      S(  3,-11), S( 15, -3), S( 17, 17), S( 32, 17), S( 33, 16), S( 15, 13), S( 17,  0), S( 17,-12),
      S(  8,-15), S( 21,  2), S( 15,  8), S( 14, 12), S( 14, 12), S( 20,  5), S( 28, -6), S( 26,-10),
      S( 19,-20), S( 17,-31), S(  8,-11), S( -2,  1), S( -1, -2), S(  4,-18), S( 19,-31), S( 19,-44),
      S( 25,-17), S( 13,  5), S( 10, -1), S(  2, -3), S(  1,  3), S(  6, -8), S(  8,  5), S( 22,-22) },

    { S( 40, 32), S( 32, 41), S(  8, 51), S( 12, 47), S( 17, 45), S( 15, 47), S( 32, 40), S( 36, 39),
      S(  3, 36), S( -7, 43), S( 20, 41), S( 28, 45), S( 19, 45), S( 33, 21), S(  0, 31), S( 10, 27),
      S(  7, 28), S( 56, 10), S( 38, 25), S( 67,  9), S( 82,  0), S( 66, 13), S( 81, -6), S( 28, 16),
      S(  0, 21), S( 17, 19), S( 27, 22), S( 53, 11), S( 43, 11), S( 37,  8), S( 35,  5), S( 21, 11),
      S(-22,  9), S(-18, 23), S(-19, 24), S(-12, 16), S(-13, 11), S(-19, 15), S(  1,  9), S(-14,  4),
      S(-32,-11), S(-17,  1), S(-28, -1), S(-19, -8), S(-22, -9), S(-24,-10), S( -3,-11), S(-25,-17),
      S(-61, -2), S(-23,-13), S(-17, -8), S(-10,-14), S( -9,-18), S(-17,-24), S(-14,-25), S(-64, -7),
      S(-22, -7), S(-16, -5), S(-15, -2), S( -6,-14), S(-10,-16), S( -7, -7), S( -5,-13), S(-14,-19) },

    { S(  0, 13), S( 13, 30), S( 23, 38), S( 29, 55), S( 36, 65), S( 50, 62), S( 30, 46), S( 33, 43),
      S(-18, 14), S(-72, 59), S(-22, 43), S(-39, 68), S(-36, 98), S(  9, 71), S(-49, 46), S(-24, 49),
      S(-12,  3), S( -2, -2), S( -9, 30), S( -7, 50), S( 18, 67), S( 32, 85), S( 44, 63), S( 12, 67),
      S( -1,-17), S( -1, 24), S(-12, 21), S(-16, 67), S(-11, 81), S( -8, 87), S( 25, 83), S( 11, 60),
      S(  5,-31), S(  7,  0), S( -2,  4), S(-12, 48), S( -8, 43), S( -1, 36), S( 14, 19), S( 18, 25),
      S(  0,-51), S( 14,-39), S(  5,-15), S(  1,-24), S(  3,-25), S(  0,-13), S( 21,-42), S(  8,-34),
      S(  1,-56), S(  9,-63), S( 17,-86), S( 10,-41), S( 13,-53), S( 12,-113), S(  9,-97), S(-10,-50),
      S( -3,-68), S( -5,-82), S(  1,-89), S(  4,-79), S(  4,-83), S( -4,-90), S( -4,-67), S( -8,-62) },

    { S(-78,-79), S(-51,-42), S(-70,-10), S(-64,  7), S(-76,-10), S(-68,-26), S(-65,-21), S(-67,-91),
      S(-62,-46), S(-19, 33), S(-40, 36), S(-49, 21), S(-31, 14), S(-40, 26), S(-29, 38), S(-56,-49),
      S(-21,-12), S(  4, 44), S( 12, 57), S( 17, 50), S( 13, 44), S( 25, 51), S(  6, 41), S(-42,-20),
      S(-19,-10), S( 16, 26), S( 19, 62), S( 37, 73), S( 21, 70), S( 44, 50), S(  6, 20), S(-44,-25),
      S( -9,-45), S( 33, 13), S( 52, 46), S( 38, 69), S( 48, 64), S( 52, 39), S( 63,  3), S(-48,-44),
      S(-29,-30), S( 24,  0), S( 36, 24), S( 22, 44), S( 41, 37), S( 23, 27), S( 30, -4), S(-44,-29),
      S(  3,-33), S(  0, -8), S(-14, 12), S(-64, 26), S(-43, 20), S(-36, 16), S(  0,-12), S(  0,-49),
      S(-35,-101), S(  9,-61), S(-24,-29), S(-51,-49), S(-38,-63), S(-78,-22), S(  3,-59), S(-22,-122) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

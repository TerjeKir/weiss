/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 54, 75), S( 41, 69), S( 46, 47), S( 47, -3), S( 45, -7), S( 40, 15), S(-42, 70), S(-45, 77),
      S( 19, 90), S( 23, 81), S( 44, 32), S( 44,-18), S( 61,-22), S(118,  3), S( 83, 54), S( 35, 66),
      S( -8, 44), S( -8, 24), S( -3,  3), S(  7,-28), S( 26,-23), S( 31,-14), S(  8, 13), S(  9, 12),
      S(-17, 13), S(-25,  9), S(-11,-10), S( -5,-18), S(  2,-17), S(  5,-15), S(-13, -2), S( -7,-10),
      S(-25,  4), S(-28, -1), S(-21, -8), S(-17,-12), S( -9, -6), S(-10, -5), S(  2,-14), S(-10,-16),
      S(-13, 12), S( -5, 12), S( -6,  1), S( -7, 13), S( -1, 20), S( 18,  1), S( 27, -3), S( -5,-13),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-134,-90), S(-47,-28), S(-73,  7), S(-30,-10), S(-11, -4), S(-62,  4), S(-47,-21), S(-106,-84),
      S(-15,-20), S( -7,  4), S( 35, -8), S( 50,  3), S( 39, -2), S( 58,-26), S(-22,  0), S(-19,-28),
      S(-16,-10), S( 28,  2), S( 22, 36), S( 41, 31), S( 75, 11), S( 48, 19), S( 28,-14), S(-20,-21),
      S(  7, -1), S( 14, 15), S( 34, 38), S( 39, 47), S( 24, 43), S( 51, 34), S( 13,  9), S( 24, -7),
      S(  4,  6), S( 14,  9), S( 16, 41), S( 20, 38), S( 22, 40), S( 32, 30), S( 34,  6), S( 24,  8),
      S(-22,-30), S(-14,  1), S( -4, 16), S(  0, 32), S( 12, 28), S(  3, 10), S( 10, -1), S(  4,-21),
      S(-35,-16), S(-34,  0), S(-20, -7), S(-10, 10), S(-10,  1), S(-16, -9), S(-25, -8), S(-11,  2),
      S(-56,-44), S(-23,-31), S(-24,-17), S( -5,  8), S( -1, 11), S( -4,-15), S(-19,-14), S(-42,-42) },

    { S(-36, 31), S(-35, 19), S(-62, 20), S(-68, 25), S(-62, 21), S(-85, 12), S(-22, 10), S(-36, 11),
      S(-27, 18), S( 13, 13), S(  0, 12), S(-20, 16), S( -3,  9), S(-14, 14), S(-19, 18), S(-61, 21),
      S( -1, 14), S( 22, 11), S( 43,  2), S( 34,  1), S( 35, -1), S( 50, 12), S( 14, 12), S( 15,  1),
      S( -8,  7), S( 32,  6), S( 27,  6), S( 45, 26), S( 41, 13), S( 26, 11), S( 39, -1), S(-10,  5),
      S( 11, -5), S(  7,  1), S( 14, 13), S( 37, 18), S( 26, 15), S( 26,  4), S( 11,  1), S( 35, -7),
      S(  7,-10), S( 33, 12), S( 20, 11), S(  9, 15), S( 17, 22), S( 25, 12), S( 38,  3), S( 33,-13),
      S( 20,-13), S( 15,-25), S( 19,-14), S( -4,  5), S(  4,  4), S( 10, -8), S( 27,-24), S( 24,-38),
      S( 18,-11), S( 27, 11), S( 16, 13), S(  5,  4), S( 15,  9), S(  6,  9), S( 18,  5), S( 28,-23) },

    { S( 27, 27), S( 20, 35), S( -1, 51), S(  1, 42), S(  6, 40), S(  7, 42), S( 25, 34), S( 30, 32),
      S(-10, 32), S(-19, 49), S(  5, 51), S( 11, 43), S(  1, 41), S( 19, 21), S(-11, 31), S(  2, 24),
      S( -6, 29), S( 39, 20), S( 21, 26), S( 46,  4), S( 62, -5), S( 47,  6), S( 71, -5), S( 16, 11),
      S( -9, 34), S( 10, 28), S( 14, 30), S( 35,  8), S( 25,  4), S( 20,  3), S( 23,  5), S( 10,  8),
      S(-21, 25), S(-22, 30), S(-18, 28), S(-11, 22), S(-14, 17), S(-29, 14), S( -5,  8), S(-16,  4),
      S(-22,  8), S(-20, 12), S(-19, 12), S(-15,  7), S(-12,  4), S(-14, -7), S(  8,-19), S(-12,-11),
      S(-41, 17), S(-12,  5), S( -3,  9), S( -1,  3), S(  2, -3), S(-14, -8), S(  0,-12), S(-46,  9),
      S(-12, 16), S(-13, 14), S(-11, 16), S(  1,  1), S(  2, -4), S( -2,  2), S(  5, -4), S(-10,  0) },

    { S(-16,  5), S( -3, 24), S(  8, 39), S( 17, 52), S( 18, 60), S( 37, 58), S( 15, 48), S( 14, 37),
      S(-16,  7), S(-56, 62), S(-31, 56), S(-57, 95), S(-58,121), S(-16, 79), S(-46, 75), S(-13, 75),
      S( -5,  5), S( -5,  3), S( -4, 41), S(-12, 63), S(  1, 76), S( 12, 89), S( 26, 57), S( 11, 68),
      S( -2,-12), S(  7, 20), S( -5, 30), S(-17, 73), S(-15, 90), S(-10, 90), S( 15, 81), S(  4, 51),
      S( 13,-33), S(  1,  0), S(  0,  9), S( -6, 49), S( -4, 46), S(  0, 31), S( 20, 15), S( 20, 16),
      S(  5,-56), S( 14,-36), S(  3, -8), S(  2,-14), S( 10,-14), S( 11,-12), S( 33,-40), S( 20,-41),
      S(  8,-63), S( 13,-62), S( 20,-73), S( 19,-33), S( 22,-42), S( 18,-109), S( 23,-107), S(  4,-59),
      S( -1,-75), S( -7,-82), S(  3,-81), S(  8,-73), S(  5,-74), S( -5,-93), S(  3,-82), S(  2,-79) },

    { S(-81,-98), S(-49,-49), S(-69,-18), S(-63,  6), S(-74,-11), S(-63,-19), S(-59,-15), S(-66,-104),
      S(-63,-44), S(-16, 33), S(-33, 45), S(-36, 37), S(-21, 29), S(-25, 43), S(-19, 49), S(-50,-43),
      S(-24,-17), S( 14, 43), S( 22, 61), S( 29, 68), S( 31, 65), S( 45, 70), S( 22, 54), S(-36,-10),
      S(-27,-20), S( 21, 22), S( 27, 60), S( 38, 85), S( 26, 84), S( 49, 60), S( 14, 29), S(-56,-15),
      S(-20,-52), S( 37, -1), S( 56, 39), S( 27, 69), S( 39, 62), S( 44, 35), S( 53, -7), S(-67,-35),
      S(-48,-41), S( 20, -8), S( 19, 18), S(  5, 38), S( 19, 34), S(  2, 19), S( 11, -8), S(-62,-31),
      S( -2,-48), S( -4,-17), S(-12,  3), S(-56, 21), S(-51, 23), S(-28,  6), S(  8,-26), S(-10,-60),
      S(-38,-109), S( 12,-78), S(-17,-43), S(-75,-43), S(-39,-54), S(-78,-30), S( -2,-78), S(-31,-120) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

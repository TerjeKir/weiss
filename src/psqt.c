/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[TYPE_NB];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 53, 66), S( 53, 57), S( 34, 52), S( 62,  0), S( 54,  5), S( 55, 10), S(-57, 70), S(-61, 72),
      S(  2, 87), S( 16, 80), S( 39, 41), S( 49, -4), S( 70, -4), S(134, 17), S( 90, 46), S( 38, 54),
      S( -7, 47), S(-10, 28), S( -9, 13), S(  7,-22), S( 24,-14), S( 39,-11), S( 11, 13), S(  4, 17),
      S(-12, 21), S(-23, 17), S(-11, -7), S(-14,-12), S( -3,-11), S(  4, -9), S( -4, -3), S( -3, -4),
      S(-20,  8), S(-31,  2), S(-27,  0), S(-22, -8), S(-13,  2), S( -6,  6), S(  3,-13), S( -3,-13),
      S( -8, 15), S(-11, 11), S(-18, 12), S( -8,  6), S(-14, 27), S( 21, 15), S( 33, -4), S(  5,-22),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-175,-81), S(-72,-19), S(-105, 21), S(-41,  1), S( -5, 12), S(-89, 24), S(-59,-15), S(-133,-101),
      S( -5,-24), S( -3, -1), S( 45,-11), S( 51, 23), S( 56,  9), S( 68,-30), S(-16,  4), S(  2,-32),
      S(-23,-14), S( 22,  4), S( 31, 46), S( 49, 45), S( 89, 24), S( 70, 29), S( 38, -6), S( -5,-17),
      S(  7,-10), S( 22, 13), S( 44, 49), S( 38, 63), S( 25, 61), S( 63, 39), S( 26, 17), S( 34, -8),
      S( -4,  1), S( 14,  9), S( 20, 50), S( 24, 52), S( 21, 52), S( 32, 46), S( 49,  8), S( 27, 11),
      S(-25,-41), S( -8, -5), S( -4, 13), S( 11, 35), S( 12, 32), S(  5, 10), S(  8, -2), S( -4,-17),
      S(-38,-23), S(-42,  1), S(-22,-13), S( -8, 10), S(-12,  4), S(-13,-17), S(-24,-16), S( -9, -6),
      S(-78,-43), S(-18,-44), S(-42,-16), S(-10,  7), S( -3,  5), S( -8,-28), S(-16,-21), S(-54,-34) },

    { S(-38, 46), S(-45, 35), S(-93, 41), S(-94, 50), S(-92, 43), S(-118, 36), S(-23, 22), S(-38, 22),
      S(-23, 21), S( 20, 26), S(  6, 25), S(-21, 30), S(  4, 20), S( -9, 28), S(-19, 34), S(-51, 28),
      S(  3, 20), S( 28, 21), S( 53, 20), S( 35, 14), S( 43, 18), S( 53, 26), S( 23, 28), S(  9, 14),
      S( -5, 11), S( 37, 14), S( 27, 16), S( 53, 32), S( 40, 30), S( 34, 21), S( 42, 13), S( -4, 17),
      S( 11, -8), S( 17,  1), S( 19, 25), S( 36, 26), S( 31, 26), S( 23, 17), S( 23,  6), S( 36, -9),
      S(  8, -8), S( 28, 10), S( 18, 13), S( 13, 20), S( 18, 22), S( 24, 10), S( 32, -1), S( 33, -9),
      S( 21, -6), S( 19,-29), S( 22, -9), S(  0,  6), S(  0,  5), S(  8,-14), S( 26,-31), S( 25,-49),
      S( 29,-10), S( 34,  4), S( 12,  8), S( -6,  6), S(  6,  7), S(  9, -4), S( 19,-11), S( 28,-21) },

    { S( 36, 55), S( 36, 64), S( -1, 83), S(  6, 74), S( 17, 73), S( 18, 72), S( 37, 66), S( 47, 62),
      S(  0, 61), S(-17, 73), S( 10, 70), S( 16, 73), S(  6, 71), S( 14, 43), S(  1, 52), S( 23, 42),
      S( -1, 55), S( 48, 35), S( 25, 53), S( 52, 34), S( 66, 23), S( 61, 33), S( 81, 11), S( 28, 35),
      S( -5, 49), S( 15, 46), S( 25, 48), S( 47, 35), S( 40, 32), S( 45, 24), S( 41, 20), S( 25, 29),
      S(-22, 35), S(-19, 50), S(-18, 48), S(-10, 38), S(-15, 34), S(-20, 34), S(  4, 25), S(-11, 21),
      S(-29, 15), S(-21, 27), S(-29, 22), S(-22, 15), S(-21, 14), S(-22,  4), S(  7, -4), S(-16, -3),
      S(-47, 19), S(-25, 13), S(-16, 17), S(-12, 10), S( -9,  2), S(-18, -6), S( -7,-14), S(-41,  3),
      S(-24, 24), S(-22, 21), S(-20, 24), S(-10,  9), S(-12,  6), S(-10, 13), S( -3,  5), S(-18,  3) },

    { S(-23, 36), S( -1, 52), S(  9, 73), S( 19, 83), S( 24, 96), S( 50, 90), S( 37, 83), S( 33, 71),
      S(-20, 23), S(-61, 66), S(-30, 70), S(-70,138), S(-64,170), S( -7,119), S(-36,110), S( 14,104),
      S(-16, 11), S( -3,  4), S(-12, 46), S(-16, 81), S(  8,113), S( 39,119), S( 57, 84), S( 14, 95),
      S(  1,-17), S(  0, 26), S(-13, 34), S(-16, 87), S(-10,118), S(  2,126), S( 40,113), S( 18, 82),
      S(  9,-32), S(  7, 13), S( -2, 18), S( -7, 60), S( -9, 66), S(  9, 49), S( 24, 34), S( 36, 35),
      S(  2,-52), S( 16,-27), S(  6, -3), S(  1, -7), S(  5, -5), S(  5, -5), S( 32,-36), S( 24,-42),
      S(  6,-61), S( 11,-55), S( 16,-66), S( 12,-30), S( 13,-40), S( 13,-117), S( 22,-138), S( 11,-80),
      S( -1,-69), S( -9,-71), S( -5,-67), S(  4,-69), S(  3,-72), S(-18,-80), S( -9,-95), S(  5,-77) },

    { S(-90,-126), S(-50,-60), S(-66,-30), S(-63,  4), S(-73,-17), S(-56,-13), S(-48, -2), S(-66,-124),
      S(-68,-44), S(-15, 36), S(-26, 44), S(-19, 38), S(-10, 29), S( -9, 40), S( -4, 50), S(-43,-38),
      S(-28,-13), S( 35, 45), S( 34, 67), S( 26, 70), S( 43, 67), S( 63, 67), S( 43, 50), S(-33,-15),
      S(-32,-13), S( 28, 26), S( 34, 71), S( 20, 92), S( 20, 85), S( 49, 61), S( 24, 25), S(-72,-16),
      S(-33,-53), S( 37,  5), S( 49, 49), S( -5, 83), S( 17, 74), S( 39, 44), S( 44,  2), S(-97,-31),
      S(-44,-43), S( 30,-10), S(  6, 24), S( -6, 46), S( 16, 39), S(  3, 27), S( 19,-11), S(-61,-33),
      S(  6,-44), S(  6,-20), S(-14,  4), S(-66, 21), S(-48, 17), S(-34, 10), S(  6,-24), S(  0,-64),
      S(-25,-123), S( 25,-77), S( -9,-43), S(-98,-41), S(-36,-72), S(-90,-26), S(  6,-78), S(-13,-144) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[7][64] = {
    { 0 },

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 47, 67), S( 34, 56), S( 35, 36), S( 31, 13), S( 36,  1), S( 13,  7), S(  7, 21), S(  7, 35),
      S(  0, 72), S( 20, 58), S( 31, 31), S( 24, -4), S( 36, -7), S( 81, 14), S( 39, 30), S( 17, 38),
      S( -4, 34), S( -7, 22), S( -2,  7), S( 19,-22), S( 28,-17), S( 31,-11), S(  6,  7), S(  2,  9),
      S(-14, 12), S(-17,  8), S( -4,-10), S( -1,-17), S(  7,-16), S(  7,-12), S( -2, -6), S( -8, -6),
      S(-18,  3), S(-23, -3), S(-16, -3), S(-11, -8), S( -2, -3), S( -1, -2), S(  5,-15), S( -3,-13),
      S( -7,  8), S(-11,  2), S(-10,  8), S(  0,  3), S( -4, 12), S( 24,  6), S( 26,-11), S(  8,-21),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-55,-66), S(-10,-10), S(-16, -6), S( -2, -7), S(  2, -1), S(-11, -5), S(-16,-16), S(-57,-46),
      S(-20,-19), S(-12, -2), S( 20, -7), S( 32, 22), S( 21, 23), S( 20,  1), S(  1, -9), S(-21,-15),
      S(-19,-15), S(  8,  1), S( 32, 27), S( 50, 25), S( 64, 27), S( 54, 38), S( 38, 12), S(  8, -4),
      S(  3, -5), S(  9, 10), S( 27, 31), S( 41, 46), S( 25, 52), S( 43, 36), S( 23, 28), S( 28, 12),
      S( -6, -3), S(  6,  5), S(  4, 30), S(  8, 38), S( 17, 36), S( 11, 35), S( 40, 12), S( 17, 11),
      S(-36,-31), S(-21,-20), S(-20, -7), S( -7, 13), S( -4, 10), S(-13,-11), S(-10,-15), S(-21,-24),
      S(-34,-20), S(-32,-14), S(-31,-31), S(-14,-15), S(-19,-14), S(-25,-32), S(-31, -7), S(-12,-11),
      S(-53,-58), S(-24,-38), S(-31,-27), S(-24,-11), S(-16,-11), S(-24,-28), S(-25,-23), S(-47,-43) },

    { S( -4,  3), S(  1, -2), S( -6,  8), S( -4,  5), S( -2,  7), S(-12, -1), S( -5,  5), S( -1,  0),
      S(-24, -2), S( -1, 10), S( -5,  9), S(  1,  9), S(  7, 11), S(  3,  9), S( -5,  9), S( -4,  1),
      S( -2,  6), S( 11, 18), S( 26, 17), S( 23, 13), S( 32, 20), S( 37, 32), S( 28, 23), S( 19, 12),
      S(-16,  2), S( 16, 16), S( 14, 13), S( 53, 19), S( 32, 27), S( 29, 16), S( 12, 23), S( -2, 14),
      S(-11,  0), S(  0,  4), S(  7, 21), S( 20, 19), S( 26, 16), S( -4, 16), S(  1,  7), S(  3, -3),
      S( -4, -1), S(  9,  7), S(  1, 12), S(  5, 13), S(  1, 12), S(  6,  5), S( 11, -3), S( 12,  6),
      S( 13, -8), S(  6,-17), S(  0, -9), S(-14, -3), S(-12, -1), S( -6,-17), S( 14,-16), S(  8,-18),
      S( 16, -3), S(  6,  2), S( -4, -8), S(-17,-10), S(-20, -6), S( -9, -7), S( -2, -1), S( 12, -5) },

    { S( 29, 43), S( 23, 49), S( 24, 48), S( 21, 46), S( 35, 42), S( 18, 50), S( 23, 47), S( 20, 53),
      S( 12, 37), S(  6, 43), S( 31, 41), S( 42, 46), S( 38, 48), S( 36, 36), S( 32, 32), S( 36, 31),
      S(  0, 31), S( 32, 23), S( 26, 32), S( 44, 25), S( 54, 23), S( 50, 34), S( 43, 22), S( 33, 23),
      S( -8, 22), S(  8, 22), S( 15, 25), S( 36, 19), S( 30, 20), S( 34, 20), S( 29, 18), S( 21, 21),
      S(-27,  5), S(-15, 14), S(-21, 16), S(-13,  8), S(-17,  7), S( -6, 10), S(  9, 12), S(  1, -2),
      S(-39,-20), S(-23, -6), S(-32,-12), S(-24,-18), S(-25,-17), S(-20,-12), S( 11,-12), S(-19,-19),
      S(-54,-28), S(-30,-26), S(-23,-22), S(-18,-25), S(-17,-26), S( -9,-32), S(-10,-23), S(-38,-19),
      S(-28,-24), S(-24,-21), S(-24,-20), S(-16,-30), S(-19,-31), S(-20,-19), S( -5,-23), S(-16,-35) },

    { S( -2,  5), S(  9, 10), S( 22, 12), S( 17, 28), S( 22, 28), S( 23, 22), S(  7,  5), S( 22, 19),
      S(-12, -5), S(-61, 17), S(-10, 12), S( -2, 18), S( 12, 46), S( 38, 31), S( -2, 10), S( 20, 13),
      S(-17, -3), S( -6,-12), S( -9,  2), S( 10, 10), S( 37, 29), S( 61, 49), S( 72, 46), S( 69, 36),
      S(-13,-14), S( -8,  7), S( -7, -8), S( -3, 23), S( 16, 32), S( 28, 41), S( 46, 38), S( 43, 32),
      S(-14, -7), S( -4, -2), S(-11,  0), S(-17, 25), S(-10, 16), S(  2, 26), S( 12, 18), S( 24, 22),
      S(-19,-17), S( -6,-18), S(-13, -3), S(-17,-20), S(-16,-25), S(-14,  1), S(  7,-19), S( -1,  2),
      S(-22,-16), S(-15,-25), S( -4,-58), S(-12,-37), S(-11,-46), S(-13,-49), S(-17,-39), S(-15,-22),
      S(-27,-21), S(-26,-35), S(-29,-46), S(-25,-56), S(-31,-47), S(-39,-44), S(-22,-24), S(-22,-17) },

    { S(-73,-50), S(-54,-27), S(-72,  6), S(-66, 20), S(-76,  5), S(-70,-25), S(-67,-15), S(-64,-66),
      S(-62,-33), S(-32, 19), S(-55, 34), S(-62, 12), S(-37, 24), S(-53, 27), S(-36, 25), S(-54,-30),
      S(-25, -6), S(-21, 51), S(-19, 58), S( -6, 44), S(-10, 39), S( -3, 61), S(-14, 55), S(-39, -6),
      S(-16,  3), S( -9, 42), S(-20, 62), S(  6, 61), S(-17, 64), S(  5, 56), S(-15, 44), S(-25,-10),
      S(  8,-23), S( -3, 24), S(  6, 47), S(  4, 61), S(  1, 60), S(  2, 43), S( 15, 18), S(-21,-32),
      S(  1,-30), S( 28, -7), S(  8, 21), S(-16, 40), S(  8, 32), S( 10, 19), S( 26,-13), S( -2,-43),
      S( 44,-43), S( 30,-21), S( 12, -5), S(-43,  9), S(-27,  4), S(-25,  3), S( 35,-32), S( 46,-73),
      S(  9,-75), S( 62,-68), S( 26,-41), S(-25,-38), S( 13,-77), S(-45,-32), S( 55,-72), S( 43,-140) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

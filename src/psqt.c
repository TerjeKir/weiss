/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[7][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 63, 55), S( 47, 57), S( 54, 33), S( 52,  1), S( 52,  0), S( 36, 19), S(-22, 53), S(-26, 55),
      S(  9, 72), S( 38, 59), S( 51, 31), S( 49, -4), S( 68, -8), S(115, 13), S( 71, 38), S( 23, 49),
      S(  0, 33), S( -2, 23), S(  2, 10), S( 21,-19), S( 28,-14), S( 35, -3), S(  1, 15), S(  0, 14),
      S(-11, 11), S(-12,  9), S( -3, -9), S(  1,-14), S(  8,-13), S(  4, -8), S( -4,  0), S( -9, -3),
      S(-14,  1), S(-23, -3), S(-18, -2), S(-15, -7), S( -9, -1), S( -8,  3), S( -1,-11), S( -4,-11),
      S( -4,  4), S(-11,  1), S(-14,  8), S( -6,  6), S(-11, 14), S( 13,  9), S( 17, -8), S(  5,-21),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-96,-86), S(-28,-22), S(-44,  4), S(-14, -6), S( -3, -2), S(-35,  7), S(-30,-18), S(-81,-65),
      S( -9,-24), S(-13, -3), S( 44,-15), S( 57, 14), S( 49, 10), S( 47,-21), S(-24, -7), S(-17,-20),
      S(-23,-18), S( 19, -1), S( 29, 37), S( 49, 32), S( 82, 17), S( 58, 30), S( 35, -8), S(-14,-15),
      S(  5, -8), S( 16, 11), S( 32, 40), S( 29, 52), S( 19, 52), S( 40, 33), S( 15, 15), S( 12, -4),
      S(  0, -5), S( 18,  7), S( 13, 40), S( 18, 43), S( 22, 38), S( 20, 38), S( 38,  6), S( 23,  6),
      S(-27,-41), S( -9,-13), S(-10,  8), S(  3, 25), S(  4, 23), S( -3,  4), S( -1, -8), S(-10,-30),
      S(-30,-15), S(-48,  1), S(-24,-20), S( -9,  1), S(-14, -2), S(-21,-21), S(-38, -5), S(-12, -4),
      S(-55,-48), S(-16,-47), S(-19,-28), S(-14,  1), S( -6,  1), S(-14,-22), S(-16,-26), S(-55,-46) },

    { S(-29, 21), S(-17, 15), S(-37, 13), S(-37, 21), S(-32, 19), S(-53,  7), S(-12, 10), S(-18, 10),
      S(-43, 22), S( 10, 21), S(  5, 19), S(-17, 20), S( -5, 17), S( -4, 21), S(-15, 23), S(-52, 20),
      S(  4, 11), S( 27, 17), S( 57, 12), S( 36, 11), S( 50, 11), S( 47, 20), S( 24, 19), S(  6,  7),
      S( -7,  6), S( 33, 10), S( 23, 11), S( 53, 19), S( 40, 22), S( 22, 14), S( 29, 11), S(-10,  9),
      S(  3,-10), S( 15, -3), S( 16, 17), S( 31, 17), S( 32, 16), S( 14, 13), S( 16,  0), S( 16,-10),
      S(  7,-14), S( 20,  3), S( 14,  8), S( 13, 12), S( 13, 12), S( 19,  5), S( 27, -6), S( 25, -8),
      S( 18,-18), S( 16,-31), S(  7,-10), S( -3,  1), S( -2, -1), S(  3,-18), S( 18,-30), S( 17,-40),
      S( 24,-15), S( 12,  5), S(  9, -1), S(  1, -3), S(  0,  3), S(  5, -7), S(  7,  6), S( 20,-20) },

    { S( 39, 33), S( 30, 41), S(  8, 51), S( 11, 47), S( 18, 45), S( 15, 48), S( 30, 41), S( 34, 40),
      S(  3, 36), S( -7, 44), S( 20, 41), S( 28, 45), S( 19, 45), S( 32, 21), S(  2, 30), S( 11, 27),
      S(  7, 28), S( 56, 10), S( 38, 25), S( 67,  9), S( 81,  0), S( 65, 14), S( 78, -5), S( 28, 16),
      S(  0, 21), S( 17, 20), S( 27, 22), S( 53, 11), S( 43, 11), S( 37,  8), S( 35,  5), S( 21, 11),
      S(-22,  9), S(-17, 23), S(-19, 24), S(-11, 16), S(-13, 11), S(-19, 15), S(  1,  9), S(-14,  4),
      S(-31,-11), S(-17,  1), S(-28, -1), S(-19, -8), S(-22, -9), S(-24,-11), S( -2,-12), S(-25,-17),
      S(-61, -3), S(-23,-14), S(-17, -8), S(-10,-14), S( -9,-18), S(-16,-24), S(-14,-26), S(-63, -9),
      S(-22, -7), S(-16, -5), S(-15, -2), S( -6,-14), S(-10,-16), S( -7, -8), S( -4,-13), S(-14,-20) },

    { S(  1, 13), S( 14, 29), S( 25, 36), S( 30, 54), S( 38, 63), S( 49, 59), S( 29, 42), S( 33, 41),
      S(-18, 13), S(-71, 56), S(-21, 40), S(-35, 61), S(-31, 91), S( 12, 65), S(-45, 40), S(-22, 44),
      S(-12,  4), S( -2, -2), S( -8, 28), S( -5, 46), S( 20, 63), S( 35, 80), S( 45, 61), S( 14, 62),
      S( -2,-16), S( -1, 24), S(-12, 19), S(-15, 64), S( -9, 76), S( -6, 82), S( 26, 79), S( 11, 59),
      S(  4,-29), S(  7,  1), S( -2,  5), S(-12, 48), S( -8, 44), S( -2, 37), S( 13, 21), S( 17, 27),
      S( -2,-47), S( 13,-37), S(  5,-14), S(  0,-23), S(  2,-24), S( -1,-12), S( 20,-40), S(  6,-30),
      S( -1,-51), S(  8,-60), S( 16,-84), S( 10,-40), S( 12,-51), S( 11,-108), S(  7,-90), S(-12,-46),
      S( -4,-63), S( -6,-77), S(  0,-86), S(  4,-77), S(  3,-81), S( -6,-85), S( -5,-61), S(-10,-56) },

    { S(-77,-75), S(-52,-40), S(-71, -8), S(-64,  9), S(-76, -8), S(-68,-26), S(-65,-20), S(-67,-87),
      S(-62,-44), S(-21, 33), S(-42, 36), S(-51, 21), S(-32, 15), S(-42, 27), S(-30, 38), S(-56,-47),
      S(-22,-12), S(  0, 45), S(  8, 57), S( 14, 50), S( 10, 45), S( 21, 52), S(  3, 41), S(-42,-20),
      S(-19,-10), S( 12, 26), S( 14, 62), S( 34, 73), S( 16, 70), S( 39, 51), S(  1, 21), S(-42,-25),
      S( -7,-45), S( 28, 14), S( 46, 46), S( 35, 69), S( 44, 64), S( 47, 39), S( 58,  4), S(-44,-45),
      S(-25,-31), S( 26, -1), S( 36, 24), S( 21, 44), S( 42, 37), S( 26, 26), S( 33, -5), S(-39,-30),
      S(  7,-35), S(  4, -9), S(-10, 11), S(-61, 25), S(-40, 19), S(-33, 15), S(  4,-14), S(  4,-51),
      S(-31,-103), S( 13,-62), S(-20,-31), S(-47,-51), S(-34,-65), S(-74,-24), S(  7,-61), S(-18,-124) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 62, 50), S( 47, 52), S( 55, 29), S( 55, -3), S( 55, -3), S( 42, 14), S(-32, 54), S(-36, 54),
      S( 10, 67), S( 39, 54), S( 51, 26), S( 51, -8), S( 71,-13), S(114,  8), S( 71, 32), S( 24, 45),
      S(  0, 27), S( -3, 17), S( -1,  4), S( 19,-24), S( 27,-19), S( 32,-11), S(  1,  8), S(  0, 10),
      S(-11,  7), S(-16,  6), S( -8,-12), S( -6,-17), S(  3,-18), S(  0,-12), S( -7, -5), S(-10, -7),
      S(-18, -2), S(-27, -5), S(-24, -5), S(-20,-10), S(-15, -4), S(-15, -1), S( -5,-14), S( -9,-14),
      S( -6,  3), S(-10,  1), S(-15,  7), S( -6,  5), S(-11, 13), S( 12,  7), S( 16, -8), S(  5,-22),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-113,-91), S(-36,-24), S(-57,  8), S(-19, -4), S( -4, -1), S(-46, 11), S(-37,-18), S(-92,-73),
      S( -9,-24), S(-15, -3), S( 43,-15), S( 61, 11), S( 52,  8), S( 54,-23), S(-28, -4), S(-17,-20),
      S(-24,-17), S( 20, -1), S( 29, 36), S( 48, 32), S( 80, 17), S( 58, 28), S( 34, -9), S(-17,-15),
      S(  5, -9), S( 16, 10), S( 33, 39), S( 29, 50), S( 20, 49), S( 39, 32), S( 15, 13), S( 13, -7),
      S(  1, -7), S( 18,  6), S( 14, 39), S( 19, 41), S( 22, 37), S( 20, 37), S( 37,  5), S( 23,  3),
      S(-25,-42), S( -7,-13), S( -8,  8), S(  5, 24), S(  6, 22), S( -1,  5), S(  0, -8), S( -9,-31),
      S(-28,-18), S(-44, -1), S(-22,-20), S( -7,  2), S(-12, -1), S(-19,-20), S(-33, -8), S(-10, -7),
      S(-53,-49), S(-15,-46), S(-17,-27), S(-12,  1), S( -4,  1), S(-12,-23), S(-14,-27), S(-53,-49) },

    { S(-37, 26), S(-25, 18), S(-50, 16), S(-51, 24), S(-46, 22), S(-69, 13), S(-15, 12), S(-24, 14),
      S(-42, 23), S( 11, 20), S(  6, 18), S(-19, 20), S( -4, 16), S( -5, 20), S(-14, 23), S(-57, 27),
      S(  5,  9), S( 27, 16), S( 57, 11), S( 36,  9), S( 49,  9), S( 48, 17), S( 22, 18), S(  7,  5),
      S( -6,  5), S( 33,  8), S( 24,  9), S( 52, 17), S( 41, 20), S( 22, 13), S( 30,  9), S( -9,  8),
      S(  5,-11), S( 16, -4), S( 18, 15), S( 31, 16), S( 32, 14), S( 16, 11), S( 17, -1), S( 19,-13),
      S(  8,-16), S( 21,  1), S( 15,  7), S( 14, 10), S( 15, 11), S( 20,  4), S( 28, -7), S( 27,-11),
      S( 21,-22), S( 18,-31), S(  9,-12), S( -1,  0), S(  0, -2), S(  6,-18), S( 22,-32), S( 23,-47),
      S( 26,-17), S( 14,  4), S( 11, -2), S(  3, -4), S(  3,  2), S(  9, -9), S( 10,  4), S( 24,-23) },

    { S( 40, 28), S( 32, 36), S(  8, 47), S( 12, 43), S( 16, 42), S( 14, 44), S( 32, 36), S( 37, 34),
      S(  2, 32), S( -9, 40), S( 18, 37), S( 25, 41), S( 16, 42), S( 31, 18), S( -3, 28), S(  7, 24),
      S(  6, 25), S( 53,  8), S( 35, 22), S( 64,  7), S( 78, -3), S( 64, 11), S( 80, -9), S( 26, 14),
      S( -1, 19), S( 16, 17), S( 25, 19), S( 50,  9), S( 40,  9), S( 34,  6), S( 33,  3), S( 18,  9),
      S(-22,  8), S(-18, 21), S(-18, 21), S(-12, 14), S(-14,  9), S(-19, 13), S( -1,  7), S(-15,  2),
      S(-31,-12), S(-17,  0), S(-28, -3), S(-19, -9), S(-22,-10), S(-24,-12), S( -4,-12), S(-25,-18),
      S(-60, -3), S(-23,-15), S(-17, -9), S(-11,-15), S( -9,-19), S(-16,-25), S(-15,-26), S(-64, -7),
      S(-22, -9), S(-16, -7), S(-15, -4), S( -7,-15), S(-10,-17), S( -8,-10), S( -5,-15), S(-14,-21) },

    { S( -3, 11), S(  9, 28), S( 18, 37), S( 25, 53), S( 30, 63), S( 47, 61), S( 26, 50), S( 29, 42),
      S(-20, 11), S(-73, 58), S(-25, 43), S(-48, 76), S(-46,107), S(  1, 77), S(-56, 55), S(-29, 55),
      S(-13,  0), S( -4, -4), S(-11, 28), S(-10, 50), S( 12, 69), S( 25, 86), S( 38, 62), S(  6, 70),
      S( -2,-20), S( -1, 20), S(-13, 19), S(-18, 65), S(-15, 82), S(-13, 90), S( 22, 82), S(  9, 56),
      S(  4,-36), S(  7, -5), S( -1,  0), S(-12, 42), S( -8, 38), S(  0, 31), S( 13, 14), S( 17, 19),
      S(  1,-57), S( 13,-43), S(  5,-19), S(  0,-27), S(  3,-28), S(  0,-16), S( 20,-46), S(  8,-41),
      S(  2,-63), S( 10,-66), S( 17,-88), S( 10,-44), S( 13,-54), S( 13,-116), S( 11,-105), S( -9,-56),
      S( -2,-74), S( -4,-88), S(  1,-90), S(  5,-79), S(  4,-83), S( -2,-96), S( -2,-75), S( -7,-72) },

    { S(-78,-86), S(-49,-45), S(-70,-14), S(-64,  4), S(-76,-13), S(-68,-27), S(-65,-23), S(-67,-97),
      S(-62,-48), S(-17, 31), S(-36, 34), S(-46, 21), S(-29, 13), S(-36, 25), S(-27, 36), S(-56,-52),
      S(-20,-13), S( 10, 42), S( 18, 53), S( 21, 47), S( 17, 42), S( 31, 49), S( 12, 39), S(-41,-20),
      S(-19,-10), S( 22, 24), S( 27, 58), S( 42, 70), S( 27, 66), S( 51, 47), S( 14, 19), S(-47,-23),
      S(-11,-42), S( 40, 11), S( 60, 42), S( 41, 66), S( 53, 60), S( 58, 36), S( 68,  2), S(-52,-39),
      S(-35,-26), S( 20,  1), S( 34, 23), S( 22, 42), S( 38, 37), S( 19, 27), S( 22, -2), S(-49,-25),
      S( -3,-29), S( -5, -5), S(-18, 13), S(-65, 27), S(-45, 21), S(-38, 17), S( -4,-10), S( -5,-46),
      S(-37,-96), S(  3,-56), S(-29,-25), S(-56,-44), S(-42,-57), S(-80,-19), S( -2,-55), S(-25,-117) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[TYPE_NB];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[6][64] = {

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 24, 34), S( 36, 43), S( 30, 64), S( 81, 27), S( 80, 32), S( 78, 27), S(-35, 81), S(-47, 58),
      S(  2, 68), S( 14, 72), S( 35, 48), S( 46, 22), S( 73, 21), S(136, 26), S( 96, 52), S( 37, 59),
      S( -8, 36), S(-11, 19), S(-10,  7), S(  4,-23), S( 22,-14), S( 38,-15), S(  9,  9), S(  2, 16),
      S(-15, 15), S(-25, 11), S(-13,-12), S(-15,-16), S( -4,-15), S(  4,-13), S( -5, -8), S( -4, -6),
      S(-22,  2), S(-34, -3), S(-30, -3), S(-25, -8), S(-15,  1), S( -7,  4), S(  1,-14), S( -5,-15),
      S(-11,  9), S(-14,  8), S(-20, 12), S(-11, 10), S(-17, 30), S( 19, 17), S( 31, -3), S(  3,-23),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-189,-76), S(-83,-17), S(-118, 25), S(-45,  4), S( -4, 14), S(-100, 31), S(-64,-13), S(-143,-106),
      S( -4,-23), S( -2, -1), S( 47,-12), S( 52, 25), S( 59, 10), S( 72,-30), S(-15,  3), S(  8,-34),
      S(-23,-12), S( 24,  6), S( 33, 49), S( 51, 49), S( 93, 27), S( 75, 32), S( 41, -6), S( -2,-17),
      S(  8, -6), S( 23, 16), S( 45, 52), S( 39, 68), S( 26, 66), S( 65, 44), S( 27, 22), S( 35, -5),
      S( -3,  2), S( 15, 11), S( 21, 53), S( 24, 55), S( 22, 55), S( 33, 51), S( 50, 11), S( 28, 12),
      S(-24,-43), S( -7, -5), S( -3, 14), S( 13, 36), S( 13, 34), S(  6, 12), S(  9, -1), S( -3,-17),
      S(-35,-34), S(-40, -4), S(-20,-16), S( -7,  9), S(-11,  5), S(-12,-16), S(-23,-15), S( -8, -7),
      S(-86,-51), S(-17,-48), S(-41,-18), S( -9,  6), S( -2,  5), S( -7,-26), S(-15,-21), S(-55,-35) },

    { S(-40, 49), S(-49, 39), S(-106, 48), S(-105, 55), S(-104, 49), S(-131, 41), S(-24, 23), S(-39, 24),
      S(-23, 22), S( 21, 28), S(  6, 27), S(-22, 34), S(  5, 22), S( -9, 32), S(-19, 36), S(-51, 30),
      S(  3, 23), S( 29, 22), S( 55, 22), S( 37, 16), S( 45, 20), S( 54, 30), S( 24, 31), S( 10, 17),
      S( -4, 14), S( 38, 17), S( 28, 18), S( 55, 36), S( 42, 33), S( 35, 24), S( 42, 17), S( -3, 20),
      S( 12, -6), S( 18,  2), S( 20, 27), S( 36, 28), S( 32, 29), S( 23, 19), S( 23,  9), S( 37, -8),
      S( 10, -8), S( 29, 10), S( 20, 13), S( 15, 20), S( 19, 23), S( 25, 12), S( 33,  0), S( 35, -8),
      S( 23,-13), S( 20,-31), S( 24,-13), S(  1,  4), S(  1,  5), S(  8,-14), S( 27,-29), S( 27,-52),
      S( 31,-17), S( 37, -2), S( 13,  7), S( -5,  3), S(  8,  4), S( 10, -3), S( 20,-10), S( 31,-24) },

    { S( 35, 62), S( 35, 72), S( -3, 92), S(  4, 82), S( 15, 82), S( 17, 80), S( 37, 75), S( 48, 69),
      S( -1, 69), S(-17, 79), S( 10, 77), S( 16, 80), S(  6, 78), S( 15, 49), S(  2, 59), S( 24, 48),
      S( -2, 64), S( 48, 42), S( 25, 60), S( 52, 42), S( 67, 30), S( 62, 41), S( 84, 17), S( 28, 43),
      S( -6, 59), S( 15, 53), S( 25, 55), S( 47, 43), S( 40, 40), S( 45, 32), S( 43, 28), S( 24, 39),
      S(-23, 41), S(-20, 56), S(-19, 55), S(-12, 44), S(-16, 40), S(-20, 41), S(  4, 32), S(-12, 28),
      S(-29, 18), S(-21, 31), S(-29, 26), S(-22, 19), S(-21, 18), S(-22,  8), S(  7,  3), S(-17,  3),
      S(-46, 18), S(-25, 16), S(-16, 19), S(-12, 12), S( -9,  4), S(-18, -2), S( -7, -9), S(-41,  8),
      S(-22, 22), S(-21, 21), S(-19, 25), S( -9, 10), S(-11,  7), S( -9, 14), S( -3, 10), S(-18,  6) },

    { S(-25, 52), S( -3, 66), S(  5, 90), S( 18, 98), S( 20,114), S( 52,106), S( 42, 98), S( 35, 87),
      S(-19, 34), S(-59, 75), S(-29, 79), S(-75,157), S(-69,193), S( -9,138), S(-38,126), S( 16,117),
      S(-14, 20), S( -1, 11), S(-10, 55), S(-14, 93), S(  9,129), S( 42,133), S( 61, 95), S( 15,112),
      S(  4, -9), S(  2, 35), S(-11, 43), S(-14,100), S(-10,134), S(  2,144), S( 41,130), S( 19, 99),
      S( 11,-25), S(  9, 21), S(  0, 26), S( -6, 70), S( -8, 77), S( 11, 60), S( 26, 45), S( 38, 47),
      S(  5,-47), S( 18,-20), S(  8,  4), S(  3, -2), S(  7,  1), S(  7,  4), S( 34,-28), S( 26,-35),
      S(  9,-57), S( 14,-50), S( 19,-61), S( 14,-25), S( 16,-35), S( 16,-114), S( 27,-140), S( 17,-83),
      S(  1,-64), S( -7,-66), S( -2,-63), S(  6,-65), S(  6,-67), S(-16,-73), S( -5,-94), S(  8,-72) },

    { S(-93,-132), S(-49,-59), S(-65,-31), S(-63,  5), S(-73,-16), S(-54, -9), S(-42,  6), S(-65,-127),
      S(-71,-41), S(-17, 36), S(-24, 41), S(-13, 33), S( -5, 29), S( -2, 44), S(  4, 59), S(-38,-28),
      S(-30, -8), S( 41, 42), S( 37, 62), S( 23, 66), S( 46, 64), S( 71, 71), S( 54, 56), S(-30, -6),
      S(-33, -4), S( 28, 28), S( 30, 67), S(  9, 87), S( 14, 84), S( 48, 62), S( 31, 34), S(-71, -1),
      S(-35,-46), S( 38,  3), S( 46, 44), S(-19, 78), S( 11, 69), S( 41, 43), S( 47,  7), S(-99,-18),
      S(-40,-46), S( 37,-17), S( 10, 14), S( -8, 35), S( 14, 30), S(  3, 22), S( 19,-11), S(-59,-30),
      S( 10,-50), S( 10,-27), S(-10, -7), S(-66,  9), S(-48,  7), S(-36,  6), S(  3,-22), S( -4,-57),
      S(-28,-121), S( 22,-72), S(-12,-42), S(-102,-46), S(-39,-76), S(-95,-24), S(  2,-71), S(-18,-134) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt-1][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

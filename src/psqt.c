/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[7][64] = {
    { 0 },

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 62, 58), S( 46, 59), S( 52, 35), S( 50,  3), S( 50,  2), S( 32, 20), S(-17, 49), S(-21, 54),
      S(  9, 74), S( 38, 62), S( 50, 33), S( 48, -2), S( 67, -6), S(115, 15), S( 69, 40), S( 22, 50),
      S(  1, 34), S( -1, 24), S(  2, 10), S( 21,-19), S( 29,-13), S( 35, -2), S(  2, 16), S(  0, 15),
      S(-10, 11), S(-12,  9), S( -3, -9), S(  1,-14), S(  9,-14), S(  4, -7), S( -3, -1), S( -8, -3),
      S(-14,  1), S(-23, -3), S(-18, -2), S(-15, -8), S( -9, -1), S( -8,  3), S( -1,-12), S( -4,-12),
      S( -3,  5), S(-11,  1), S(-13,  8), S( -6,  6), S(-11, 14), S( 13, 10), S( 18, -8), S(  6,-21),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-89,-83), S(-24,-21), S(-39,  1), S(-12, -7), S( -3, -3), S(-30,  4), S(-27,-18), S(-76,-61),
      S(-11,-25), S(-15, -5), S( 41,-18), S( 52, 12), S( 45,  9), S( 42,-21), S(-23,-10), S(-18,-20),
      S(-21,-18), S( 19, -2), S( 28, 35), S( 47, 29), S( 79, 16), S( 57, 31), S( 36, -8), S(-11,-14),
      S(  5, -7), S( 15, 12), S( 32, 40), S( 29, 51), S( 18, 52), S( 39, 34), S( 13, 20), S( 12, -2),
      S(  0, -2), S( 17,  7), S( 12, 40), S( 17, 43), S( 21, 38), S( 19, 38), S( 37,  8), S( 24,  9),
      S(-28,-38), S(-10,-13), S(-12,  7), S(  2, 24), S(  3, 22), S( -4,  3), S( -2, -8), S(-12,-26),
      S(-29,-13), S(-47,  2), S(-26,-21), S(-10,  0), S(-16, -2), S(-23,-22), S(-36, -2), S(-11, -1),
      S(-51,-47), S(-16,-47), S(-19,-29), S(-14,  0), S( -5, -1), S(-15,-19), S(-17,-25), S(-52,-44) },

    { S(-25, 17), S(-13, 11), S(-31,  9), S(-31, 17), S(-27, 15), S(-46,  3), S(-11,  7), S(-16,  7),
      S(-46, 17), S(  6, 18), S(  2, 16), S(-17, 16), S( -7, 14), S( -5, 18), S(-18, 20), S(-50, 14),
      S(  4, 11), S( 27, 18), S( 55, 12), S( 34,  9), S( 48, 10), S( 46, 21), S( 25, 21), S(  6,  8),
      S( -9,  7), S( 33, 11), S( 22, 11), S( 54, 18), S( 40, 23), S( 21, 15), S( 28, 16), S(-11, 11),
      S(  2, -8), S( 13, -1), S( 16, 18), S( 31, 18), S( 32, 17), S( 13, 14), S( 14,  2), S( 14, -8),
      S(  6,-11), S( 19,  5), S( 13,  9), S( 13, 13), S( 13, 13), S( 18,  6), S( 26, -4), S( 24, -4),
      S( 18,-14), S( 15,-27), S(  6,-10), S( -4,  1), S( -3,  0), S(  2,-17), S( 16,-23), S( 18,-34),
      S( 24,-12), S( 12,  6), S(  9, -2), S(  1, -7), S(  0, -1), S(  5, -3), S(  7,  8), S( 20,-15) },

    { S( 37, 36), S( 29, 44), S(  8, 52), S( 11, 49), S( 19, 46), S( 15, 50), S( 29, 44), S( 33, 45),
      S(  4, 37), S( -7, 45), S( 20, 42), S( 28, 46), S( 20, 46), S( 32, 24), S(  6, 31), S( 14, 29),
      S(  6, 30), S( 56, 11), S( 37, 26), S( 67, 10), S( 80,  2), S( 63, 17), S( 75,  0), S( 28, 18),
      S( -1, 22), S( 17, 20), S( 27, 22), S( 54, 11), S( 44, 11), S( 37,  9), S( 36,  7), S( 22, 13),
      S(-23,  9), S(-17, 23), S(-19, 24), S(-12, 15), S(-14, 11), S(-19, 15), S(  2,  9), S(-13,  4),
      S(-32,-13), S(-17, -1), S(-28, -3), S(-19,-10), S(-22,-11), S(-24,-12), S( -1,-13), S(-25,-18),
      S(-62, -6), S(-24,-16), S(-17,-10), S(-10,-16), S( -9,-20), S(-16,-27), S(-14,-28), S(-62,-13),
      S(-22, -8), S(-16, -6), S(-15, -3), S( -6,-15), S(-10,-17), S( -7, -8), S( -4,-14), S(-14,-21) },

    { S(  1, 12), S( 15, 27), S( 27, 33), S( 31, 52), S( 39, 59), S( 46, 54), S( 27, 37), S( 33, 38),
      S(-18, 11), S(-71, 51), S(-19, 36), S(-30, 53), S(-25, 82), S( 16, 59), S(-40, 33), S(-19, 38),
      S(-12,  4), S( -2, -2), S( -7, 25), S( -3, 41), S( 23, 58), S( 39, 74), S( 47, 57), S( 17, 56),
      S( -3,-15), S( -1, 24), S(-11, 16), S(-13, 59), S( -6, 69), S( -3, 75), S( 29, 73), S( 13, 56),
      S(  2,-25), S(  6,  2), S( -3,  6), S(-13, 48), S( -9, 44), S( -2, 38), S( 13, 23), S( 17, 29),
      S( -4,-42), S( 12,-34), S(  3,-12), S( -1,-22), S(  1,-23), S( -2,-10), S( 19,-37), S(  5,-25),
      S( -3,-45), S(  6,-55), S( 15,-82), S(  9,-38), S( 12,-50), S(  8,-101), S(  4,-81), S(-14,-42),
      S( -7,-57), S( -9,-71), S( -3,-81), S(  3,-76), S(  1,-78), S( -9,-78), S( -8,-54), S(-12,-49) },

    { S(-76,-70), S(-52,-38), S(-71, -5), S(-64, 11), S(-76, -6), S(-68,-25), S(-65,-19), S(-67,-83),
      S(-62,-42), S(-23, 32), S(-44, 37), S(-53, 21), S(-33, 16), S(-44, 28), S(-31, 38), S(-56,-44),
      S(-23,-11), S( -4, 46), S(  3, 58), S( 10, 50), S(  6, 45), S( 16, 53), S( -1, 42), S(-42,-19),
      S(-19,-10), S(  7, 27), S(  8, 63), S( 30, 73), S( 11, 71), S( 33, 52), S( -5, 22), S(-39,-26),
      S( -5,-46), S( 23, 15), S( 40, 48), S( 31, 70), S( 38, 66), S( 41, 41), S( 52,  5), S(-40,-46),
      S(-20,-34), S( 28, -2), S( 35, 24), S( 18, 45), S( 42, 37), S( 29, 25), S( 38, -7), S(-33,-33),
      S( 12,-37), S(  7,-10), S( -7,  9), S(-57, 24), S(-36, 18), S(-30, 14), S(  9,-16), S(  8,-53),
      S(-26,-106), S( 18,-65), S(-15,-33), S(-42,-54), S(-29,-68), S(-69,-27), S( 12,-63), S(-13,-128) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}

/*
  Weiss is a UCI compliant chess engine.
  Copyright (C) 2020  Terje Kirstihagen

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

#include "board.h"
#include "evaluate.h"
#include "psqt.h"


extern const int PieceTypeValue[7];


int PSQT[PIECE_NB][64];

// Black's point of view - easier to read as it's not upside down
const int PieceSqValue[7][64] = {
    { 0 },

    { S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0),
      S( 58, 60), S( 43, 60), S( 48, 37), S( 44,  5), S( 46,  3), S( 26, 19), S( -9, 40), S(-12, 51),
      S(  8, 76), S( 35, 63), S( 47, 34), S( 42,  0), S( 61, -4), S(110, 16), S( 62, 42), S( 20, 51),
      S(  0, 34), S( -3, 24), S(  0, 10), S( 20,-20), S( 27,-14), S( 31, -4), S(  0, 15), S(  0, 15),
      S(-10, 12), S(-13,  9), S( -1,-10), S(  0,-15), S(  7,-14), S(  6, -8), S( -5, -1), S( -8, -3),
      S(-14,  2), S(-20, -4), S(-16, -3), S(-11, -8), S( -6, -2), S( -6,  2), S(  2,-12), S( -4,-11),
      S( -3,  6), S( -9,  1), S(-12,  8), S( -4,  6), S( -8, 14), S( 14, 10), S( 19, -9), S(  6,-20),
      S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0), S(  0,  0) },

    { S(-77,-78), S(-19,-18), S(-30, -2), S( -9, -9), S( -2, -4), S(-22,  1), S(-23,-18), S(-68,-56),
      S(-14,-25), S(-17, -8), S( 35,-18), S( 44, 11), S( 36,  9), S( 32,-18), S(-18,-12), S(-20,-20),
      S(-21,-18), S( 20, -2), S( 25, 31), S( 42, 26), S( 73, 12), S( 56, 31), S( 36, -5), S( -8,-15),
      S(  3, -8), S( 14, 13), S( 29, 37), S( 28, 47), S( 18, 51), S( 34, 33), S( 14, 23), S( 11,  0),
      S(  0, -1), S( 16,  7), S( 11, 39), S( 17, 42), S( 19, 38), S( 18, 38), S( 34,  8), S( 20, 10),
      S(-28,-36), S(-13,-12), S(-13,  6), S(  1, 24), S(  2, 21), S( -8,  1), S( -6, -9), S(-14,-25),
      S(-28,-13), S(-43,  1), S(-26,-21), S(-11, -2), S(-15, -1), S(-25,-21), S(-33,  0), S( -8,  0),
      S(-48,-49), S(-13,-45), S(-17,-28), S(-14, -2), S( -6, -3), S(-11,-16), S(-15,-23), S(-49,-43) },

    { S(-18, 12), S( -8,  7), S(-22,  6), S(-21, 12), S(-18, 11), S(-34,  0), S( -9,  6), S(-11,  4),
      S(-45, 11), S(  2, 15), S( -2, 13), S(-13, 12), S( -7, 10), S( -5, 14), S(-18, 15), S(-40,  7),
      S(  2, 11), S( 25, 18), S( 47, 11), S( 29,  6), S( 41,  8), S( 43, 24), S( 23, 22), S(  6, 10),
      S(-12,  5), S( 28, 13), S( 18, 10), S( 50, 16), S( 38, 22), S( 17, 15), S( 26, 19), S(-13, 12),
      S( -2, -7), S(  9, -1), S( 12, 18), S( 27, 18), S( 28, 17), S(  8, 15), S(  9,  2), S( 10, -7),
      S(  4, -8), S( 14,  5), S( 11, 11), S( 11, 14), S( 11, 14), S( 14,  8), S( 20, -3), S( 20, -2),
      S( 17,-11), S( 15,-22), S(  5, -9), S( -5,  0), S( -3,  2), S(  0,-15), S( 19,-17), S( 19,-29),
      S( 24, -9), S( 10,  6), S(  7, -4), S( -3, -9), S( -5, -3), S(  7,  2), S(  4,  8), S( 22,-12) },

    { S( 36, 38), S( 27, 44), S( 12, 49), S( 13, 46), S( 23, 43), S( 15, 50), S( 27, 46), S( 28, 47),
      S(  5, 38), S( -6, 44), S( 19, 40), S( 28, 43), S( 21, 44), S( 32, 24), S( 13, 30), S( 18, 29),
      S(  6, 30), S( 54, 12), S( 36, 25), S( 63, 11), S( 73,  4), S( 59, 18), S( 65,  4), S( 29, 19),
      S(  0, 23), S( 18, 20), S( 27, 22), S( 52, 10), S( 43, 11), S( 36, 10), S( 35,  8), S( 22, 14),
      S(-22,  9), S(-16, 22), S(-18, 22), S(-12, 14), S(-14, 10), S(-18, 14), S(  3, 10), S(-12,  4),
      S(-32,-13), S(-16, -2), S(-28, -4), S(-20,-12), S(-22,-13), S(-24,-12), S(  0,-13), S(-24,-18),
      S(-61, -9), S(-25,-17), S(-19,-12), S(-12,-18), S(-10,-22), S(-18,-29), S(-15,-29), S(-57,-16),
      S(-24,-10), S(-18, -8), S(-17, -5), S( -9,-17), S(-12,-19), S( -9,-11), S( -6,-15), S(-16,-22) },

    { S(  0,  9), S( 15, 23), S( 27, 27), S( 30, 46), S( 37, 50), S( 40, 43), S( 22, 26), S( 30, 32),
      S(-17,  7), S(-68, 40), S(-17, 27), S(-21, 40), S(-14, 68), S( 22, 48), S(-28, 22), S(-12, 27),
      S(-13,  2), S( -2, -5), S( -7, 18), S(  0, 30), S( 25, 47), S( 43, 63), S( 49, 49), S( 21, 44),
      S( -4,-15), S( -2, 21), S(-10,  9), S(-10, 47), S( -2, 56), S( -1, 62), S( 30, 61), S( 13, 46),
      S( -1,-19), S(  4,  2), S( -4,  6), S(-13, 42), S( -9, 37), S( -3, 36), S( 10, 23), S( 15, 28),
      S( -7,-33), S(  9,-30), S(  1,-11), S( -3,-21), S( -1,-22), S( -4, -9), S( 16,-32), S(  1,-16),
      S( -7,-34), S(  3,-46), S( 12,-77), S(  6,-36), S(  9,-48), S(  3,-86), S( -1,-68), S(-17,-35),
      S(-11,-45), S(-12,-59), S( -6,-70), S(  0,-71), S( -3,-68), S(-14,-66), S(-12,-43), S(-16,-37) },

    { S(-75,-62), S(-53,-34), S(-71, -1), S(-65, 14), S(-76, -2), S(-69,-25), S(-66,-18), S(-66,-76),
      S(-62,-39), S(-26, 31), S(-48, 37), S(-56, 19), S(-34, 18), S(-47, 29), S(-32, 38), S(-56,-39),
      S(-24,-10), S(-11, 47), S( -5, 58), S(  5, 50), S(  1, 46), S(  8, 56), S( -8, 46), S(-42,-17),
      S(-19, -9), S( -1, 30), S( -2, 63), S( 22, 72), S(  1, 70), S( 23, 52), S(-14, 29), S(-35,-25),
      S( -1,-42), S( 13, 16), S( 29, 48), S( 23, 69), S( 27, 65), S( 29, 41), S( 40,  7), S(-33,-47),
      S(-12,-36), S( 31, -3), S( 29, 24), S(  9, 44), S( 35, 36), S( 30, 22), S( 43, -9), S(-22,-37),
      S( 21,-41), S( 15,-14), S(  1,  5), S(-49, 20), S(-29, 14), S(-21, 10), S( 15,-20), S( 17,-57),
      S(-19,-106), S( 26,-68), S( -6,-37), S(-32,-56), S(-18,-71), S(-58,-31), S( 20,-66), S( -3,-133) },
};

// Initialize the piece square tables with piece values included
CONSTR InitPSQT() {

    // Black scores are negative (white double negated -> positive)
    for (PieceType pt = PAWN; pt <= KING; ++pt)
        for (Square sq = A1; sq <= H8; ++sq) {
            // Base piece value + the piece square value
            PSQT[MakePiece(BLACK, pt)][sq] = -(PieceTypeValue[pt] + PieceSqValue[pt][sq]);
            // Same score inverted used for white on the square mirrored horizontally
            PSQT[MakePiece(WHITE, pt)][MirrorSquare(sq)] = -PSQT[pt][sq];
        }
}
